<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1f2937">
    <title>Flash Cards Pro - Crane Operations</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèóÔ∏è</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        html, body { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow-x: hidden; 
            font-family: system-ui, -apple-system, sans-serif;
        }
        #root { min-height: 100vh; }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .line-clamp-2 { 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
        }
        button:active { transform: scale(0.98); }
        @media screen and (max-width: 768px) { 
            input, textarea, select { font-size: 16px !important; } 
        }
        .speaking { animation: pulse 1s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, createContext, useContext } = React;

        // Simple Icons
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                search: "üîç", plus: "‚ûï", moon: "üåô", sun: "‚òÄÔ∏è", menu: "‚ò∞",
                cards: "üé¥", study: "üìö", stats: "üìä", edit: "‚úèÔ∏è", delete: "üóëÔ∏è",
                check: "‚úÖ", x: "‚ùå", brain: "üß†", crane: "üèóÔ∏è", upload: "üìÅ",
                speaker: "üîä", mute: "üîá"
            };
            return React.createElement('span', {
                className: `inline-block ${className}`,
                style: { fontSize: '1.2em' }
            }, icons[name] || "üìù");
        };

        // Context
        const FlashCardsContext = createContext(null);
        const useFlashCards = () => {
            const context = useContext(FlashCardsContext);
            if (!context) throw new Error('useFlashCards must be used within FlashCardsProvider');
            return context;
        };

        // Speech Service
        class SpeechService {
            static speak(text, rate = 1.0) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel(); // Stop any current speech
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = rate;
                    utterance.pitch = 1;
                    utterance.volume = 1;
                    speechSynthesis.speak(utterance);
                    return utterance;
                }
                return null;
            }
            
            static stop() {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                }
            }
            
            static isSupported() {
                return 'speechSynthesis' in window;
            }
        }

        // Import Service
        class ImportService {
            static parseQuestionsFromText(text) {
                const cards = [];
                const questionBlocks = text.split(/\n\s*(?=Q\d+\))/);
                
                questionBlocks.forEach((block, index) => {
                    if (!block.trim()) return;
                    
                    const lines = block.trim().split('\n');
                    let questionText = '';
                    let answerText = '';
                    let inAnswer = false;
                    
                    lines.forEach(line => {
                        if (line.startsWith('Answer:')) {
                            inAnswer = true;
                            answerText = line.replace('Answer:', '').trim();
                        } else if (inAnswer) {
                            answerText += '\n' + line.trim();
                        } else {
                            questionText += (questionText ? ' ' : '') + line.trim();
                        }
                    });
                    
                    if (questionText && answerText) {
                        // Determine difficulty
                        let difficulty = 'medium';
                        if (questionText.includes('a)') && questionText.includes('b)')) {
                            difficulty = 'hard';
                        } else if (questionText.length < 80) {
                            difficulty = 'easy';
                        }
                        
                        // Extract tags
                        let tags = [];
                        if (questionText.toLowerCase().includes('loler')) tags.push('LOLER');
                        if (questionText.toLowerCase().includes('personnel')) tags.push('personnel');
                        if (questionText.toLowerCase().includes('safety')) tags.push('safety');
                        if (questionText.toLowerCase().includes('wind')) tags.push('wind');
                        if (questionText.toLowerCase().includes('crane')) tags.push('crane');
                        if (questionText.toLowerCase().includes('lift')) tags.push('lifting');
                        
                        cards.push({
                            id: Date.now() + index,
                            question: questionText.trim(),
                            answer: answerText.trim(),
                            category: 'Crane Operations',
                            tags,
                            difficulty,
                            media: [],
                            created: new Date().toISOString(),
                            lastStudied: null,
                            nextReview: null,
                            timesStudied: 0,
                            timesCorrect: 0,
                            easeFactor: 2.5,
                            interval: 0,
                            repetitions: 0,
                            lapses: 0,
                        });
                    }
                });
                
                return cards;
            }
        }

        // Storage Service
        class StorageService {
            static exportData(state) {
                const data = {
                    version: '3.0',
                    exported: new Date().toISOString(),
                    ...state,
                    categories: Array.from(state.categories),
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `crane-flashcards-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }

        // Card Component with Speech
        function MobileCardItem({ card, onEdit, onDelete, onStudy }) {
            const { state: { theme } } = useFlashCards();
            const [showActions, setShowActions] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            
            const handleSpeak = (e) => {
                e.stopPropagation();
                if (isSpeaking) {
                    SpeechService.stop();
                    setIsSpeaking(false);
                } else {
                    setIsSpeaking(true);
                    const utterance = SpeechService.speak(`Question: ${card.question}. Answer: ${card.answer}`);
                    if (utterance) {
                        utterance.onend = () => setIsSpeaking(false);
                    }
                }
            };
            
            return (
                <div className={`relative mb-3 rounded-xl border transition-all cursor-pointer ${
                    theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                }`}>
                    <div className="p-4" onClick={() => setShowActions(!showActions)}>
                        <div className="flex justify-between items-start mb-2">
                            <h4 className="font-medium text-base leading-tight pr-2 flex-1">{card.question}</h4>
                            <div className="flex items-center gap-2 flex-shrink-0">
                                <button onClick={handleSpeak}
                                    className={`p-1 rounded ${isSpeaking ? 'speaking text-blue-500' : 'text-gray-400 hover:text-blue-500'}`}>
                                    <Icon name={isSpeaking ? "mute" : "speaker"} className="w-4 h-4" />
                                </button>
                                <span className={`text-xs px-2 py-1 rounded ${
                                    card.difficulty === 'easy' ? 'bg-green-500 text-white'
                                    : card.difficulty === 'medium' ? 'bg-yellow-500 text-white'
                                    : 'bg-red-500 text-white'
                                }`}>
                                    {card.difficulty}
                                </span>
                            </div>
                        </div>
                        <p className={`text-sm mb-3 line-clamp-2 ${
                            theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                        }`}>
                            {card.answer}
                        </p>
                        {card.category && (
                            <span className={`text-xs px-2 py-1 rounded ${
                                theme === 'dark' ? 'bg-blue-900 text-blue-300' : 'bg-blue-100 text-blue-700'
                            }`}>
                                {card.category}
                            </span>
                        )}
                    </div>
                    
                    <div className={`overflow-hidden transition-all duration-300 ${
                        showActions ? 'max-h-16' : 'max-h-0'
                    }`}>
                        <div className={`flex border-t ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                            <button onClick={(e) => { e.stopPropagation(); onStudy(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium text-blue-500 ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                } border-r ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                                Study
                            </button>
                            <button onClick={(e) => { e.stopPropagation(); onEdit(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                } border-r ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                                Edit
                            </button>
                            <button onClick={(e) => { e.stopPropagation(); onDelete(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium text-red-500 ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                }`}>
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Study Card with Speech
        function MobileStudyCard({ card, isFlipped, onFlip }) {
            const { state: { theme, autoReadEnabled } } = useFlashCards();
            const [isSpeaking, setIsSpeaking] = useState(false);
            
            // Auto-read when card loads or flips
            useEffect(() => {
                if (autoReadEnabled && SpeechService.isSupported()) {
                    setIsSpeaking(true);
                    const text = isFlipped ? card.answer : card.question;
                    const utterance = SpeechService.speak(text);
                    if (utterance) {
                        utterance.onend = () => setIsSpeaking(false);
                    }
                }
            }, [card.id, isFlipped, autoReadEnabled]);
            
            const handleSpeak = (e) => {
                e.stopPropagation();
                if (isSpeaking) {
                    SpeechService.stop();
                    setIsSpeaking(false);
                } else {
                    setIsSpeaking(true);
                    const text = isFlipped ? card.answer : card.question;
                    const utterance = SpeechService.speak(text);
                    if (utterance) {
                        utterance.onend = () => setIsSpeaking(false);
                    }
                }
            };
            
            return (
                <div className="relative w-full h-80 perspective-1000">
                    <div className={`relative w-full h-full transition-transform duration-500 transform-style-preserve-3d cursor-pointer ${
                        isFlipped ? 'rotate-y-180' : ''
                    }`}>
                        <div className={`absolute inset-0 backface-hidden rounded-2xl p-6 flex flex-col ${
                            theme === 'dark' 
                                ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white' 
                                : 'bg-gradient-to-br from-white to-gray-100'
                        } shadow-xl border ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`} onClick={onFlip}>
                            <div className="flex justify-between items-start mb-4">
                                <span className={`text-xs px-2 py-1 rounded ${
                                    card.difficulty === 'easy' ? 'bg-green-500 text-white'
                                    : card.difficulty === 'medium' ? 'bg-yellow-500 text-white'
                                    : 'bg-red-500 text-white'
                                }`}>
                                    {card.difficulty}
                                </span>
                                <button onClick={handleSpeak}
                                    className={`p-2 rounded-lg ${isSpeaking ? 'speaking text-blue-500' : 'text-gray-400 hover:text-blue-500'}`}>
                                    <Icon name={isSpeaking ? "mute" : "speaker"} className="w-5 h-5" />
                                </button>
                            </div>
                            <div className="flex-1 flex items-center justify-center p-2">
                                <div className="text-center">
                                    <h2 className="text-lg font-medium mb-4 leading-relaxed">{card.question}</h2>
                                </div>
                            </div>
                            <div className="text-center text-xs opacity-60">Tap to reveal answer</div>
                        </div>
                        
                        <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-2xl p-6 flex flex-col ${
                            theme === 'dark' 
                                ? 'bg-gradient-to-br from-blue-900 to-blue-800 text-white' 
                                : 'bg-gradient-to-br from-blue-50 to-blue-100'
                        } shadow-xl border ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`} onClick={onFlip}>
                            <div className="flex justify-end mb-4">
                                <button onClick={handleSpeak}
                                    className={`p-2 rounded-lg ${isSpeaking ? 'speaking text-blue-300' : 'text-gray-400 hover:text-blue-300'}`}>
                                    <Icon name={isSpeaking ? "mute" : "speaker"} className="w-5 h-5" />
                                </button>
                            </div>
                            <div className="flex-1 flex items-center justify-center p-2">
                                <div className="text-center">
                                    <h2 className="text-lg font-medium leading-relaxed whitespace-pre-line">{card.answer}</h2>
                                </div>
                            </div>
                            <div className="text-center text-xs opacity-60">Tap to show question</div>
                        </div>
                    </div>
                </div>
            );
        }

        // Study Mode (same as before)
        function MobileStudyMode({ cards, onComplete }) {
            const { state: { theme, autoReadEnabled }, toggleAutoRead } = useFlashCards();
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [results, setResults] = useState({ correct: 0, incorrect: 0 });
            const [startTime] = useState(Date.now());
            const [showCompletePrompt, setShowCompletePrompt] = useState(false);
            
            const currentCard = cards[currentIndex];
            const progress = ((currentIndex + 1) / cards.length) * 100;
            
            const handleResponse = (isCorrect) => {
                if (isCorrect) {
                    setResults(prev => ({ ...prev, correct: prev.correct + 1 }));
                } else {
                    setResults(prev => ({ ...prev, incorrect: prev.incorrect + 1 }));
                }
                
                // Stop any current speech before moving to next card
                SpeechService.stop();
                
                if (currentIndex < cards.length - 1) {
                    setTimeout(() => {
                        setCurrentIndex(prev => prev + 1);
                        setIsFlipped(false);
                    }, 800);
                } else {
                    setShowCompletePrompt(true);
                }
            };
            
            const handleComplete = () => {
                const duration = Math.floor((Date.now() - startTime) / 1000);
                onComplete({ ...results, duration });
            };
            
            if (!currentCard) {
                return (
                    <div className="flex items-center justify-center h-96">
                        <div className="text-center">
                            <Icon name="study" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                            <p className="text-lg">No cards to study</p>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="space-y-4 pb-6">
                    <div className="p-4 rounded-xl">
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-sm font-medium">{currentIndex + 1} / {cards.length}</span>
                            <div className="flex items-center gap-4">
                                {SpeechService.isSupported() && (
                                    <button onClick={toggleAutoRead}
                                        className={`flex items-center gap-1 px-2 py-1 rounded text-xs ${
                                            autoReadEnabled 
                                                ? 'bg-blue-500 text-white' 
                                                : theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'
                                        }`}>
                                        <Icon name={autoReadEnabled ? "speaker" : "mute"} className="w-3 h-3" />
                                        Auto
                                    </button>
                                )}
                                <div className="flex items-center gap-1">
                                    <Icon name="check" className="w-4 h-4 text-green-500" />
                                    <span className="text-sm">{results.correct}</span>
                                </div>
                                <div className="flex items-center gap-1">
                                    <Icon name="x" className="w-4 h-4 text-red-500" />
                                    <span className="text-sm">{results.incorrect}</span>
                                </div>
                            </div>
                        </div>
                        <div className={`h-2 rounded-full overflow-hidden ${
                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                        }`}>
                            <div className="h-full bg-blue-500 transition-all duration-500"
                                style={{ width: `${progress}%` }} />
                        </div>
                    </div>
                    
                    <div className="px-4">
                        <MobileStudyCard card={currentCard} isFlipped={isFlipped} onFlip={() => setIsFlipped(!isFlipped)} />
                    </div>
                    
                    <div className="px-4">
                        {isFlipped ? (
                            <div className="grid grid-cols-2 gap-3">
                                <button onClick={() => handleResponse(false)}
                                    className="py-4 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium">
                                    ‚ùå Incorrect
                                </button>
                                <button onClick={() => handleResponse(true)}
                                    className="py-4 bg-green-500 text-white rounded-xl hover:bg-green-600 font-medium">
                                    ‚úÖ Correct
                                </button>
                            </div>
                        ) : (
                            <button onClick={() => setIsFlipped(true)}
                                className="w-full py-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 text-lg font-medium">
                                Show Answer
                            </button>
                        )}
                    </div>
                    
                    {showCompletePrompt && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className={`w-full max-w-sm rounded-2xl p-6 ${
                                theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                            }`}>
                                <h3 className="text-xl font-semibold mb-4 text-center">Session Complete! üéâ</h3>
                                <div className="space-y-3 mb-6">
                                    <div className="flex justify-between">
                                        <span>Cards studied:</span>
                                        <span className="font-medium">{results.correct + results.incorrect}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Correct:</span>
                                        <span className="font-medium text-green-500">{results.correct}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Incorrect:</span>
                                        <span className="font-medium text-red-500">{results.incorrect}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Accuracy:</span>
                                        <span className="font-medium">
                                            {results.correct + results.incorrect > 0
                                                ? Math.round((results.correct / (results.correct + results.incorrect)) * 100)
                                                : 0}%
                                        </span>
                                    </div>
                                </div>
                                <button onClick={handleComplete}
                                    className="w-full py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium">
                                    Finish Session
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Card Editor (same as before)
        function MobileCardEditor({ card, onSave, onCancel }) {
            const { state: { theme } } = useFlashCards();
            const [question, setQuestion] = useState(card?.question || '');
            const [answer, setAnswer] = useState(card?.answer || '');
            const [category, setCategory] = useState(card?.category || '');
            const [difficulty, setDifficulty] = useState(card?.difficulty || 'medium');
            
            const handleSubmit = () => {
                if (!question.trim() || !answer.trim()) return;
                onSave({
                    question: question.trim(),
                    answer: answer.trim(),
                    category: category.trim(),
                    tags: [],
                    difficulty,
                    media: [],
                });
            };
            
            return (
                <div className="space-y-6">
                    <div>
                        <label className="block text-sm font-medium mb-2">Question</label>
                        <textarea value={question} onChange={(e) => setQuestion(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            rows={3} placeholder="Enter your question..." required />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-2">Answer</label>
                        <textarea value={answer} onChange={(e) => setAnswer(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            rows={3} placeholder="Enter the answer..." required />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-2">Category</label>
                        <input value={category} onChange={(e) => setCategory(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            placeholder="Optional category" />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-3">Difficulty</label>
                        <div className="grid grid-cols-3 gap-3">
                            {['easy', 'medium', 'hard'].map(level => (
                                <button key={level} type="button" onClick={() => setDifficulty(level)}
                                    className={`py-3 rounded-xl border transition-colors text-sm font-medium ${
                                        difficulty === level
                                            ? level === 'easy' ? 'bg-green-500 text-white border-green-500'
                                            : level === 'medium' ? 'bg-yellow-500 text-white border-yellow-500'
                                            : 'bg-red-500 text-white border-red-500'
                                            : theme === 'dark' ? 'border-gray-700 hover:border-gray-600'
                                            : 'border-gray-300 hover:border-gray-400'
                                    }`}>
                                    {level.charAt(0).toUpperCase() + level.slice(1)}
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    <div className="flex gap-3 pt-4">
                        <button type="button" onClick={onCancel}
                            className={`flex-1 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'border-gray-700 hover:bg-gray-800' 
                                    : 'border-gray-300 hover:bg-gray-100'
                            } transition-colors font-medium`}>
                            Cancel
                        </button>
                        <button type="button" onClick={handleSubmit}
                            disabled={!question.trim() || !answer.trim()}
                            className="flex-1 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium">
                            {card ? 'Update' : 'Create'}
                        </button>
                    </div>
                </div>
            );
        }

        // Import Modal
        function ImportModal({ onClose, onImport }) {
            const { state: { theme } } = useFlashCards();
            const [importText, setImportText] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            
            const handleImport = async () => {
                if (!importText.trim()) return;
                
                setIsProcessing(true);
                try {
                    const cards = ImportService.parseQuestionsFromText(importText);
                    if (cards.length > 0) {
                        onImport(cards);
                        onClose();
                    } else {
                        alert('No valid questions found in the text.');
                    }
                } catch (error) {
                    alert('Error parsing questions: ' + error.message);
                } finally {
                    setIsProcessing(false);
                }
            };
            
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (file && file.type === 'text/plain') {
                    const reader = new FileReader();
                    reader.onload = (e) => setImportText(e.target.result);
                    reader.readAsText(file);
                }
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className={`w-full max-w-2xl rounded-2xl ${
                        theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                    } p-6`}>
                        <h2 className="text-xl font-semibold mb-6">Import Questions üìÅ</h2>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Upload Text File</label>
                                <input type="file" accept=".txt" onChange={handleFileUpload}
                                    className={`w-full px-4 py-3 rounded-xl border ${
                                        theme === 'dark' 
                                            ? 'bg-gray-800 border-gray-700' 
                                            : 'bg-gray-100 border-gray-300'
                                    } text-base`} />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium mb-2">Or paste questions here:</label>
                                <textarea value={importText} onChange={(e) => setImportText(e.target.value)}
                                    className={`w-full px-4 py-3 rounded-xl border ${
                                        theme === 'dark' 
                                            ? 'bg-gray-800 border-gray-700 text-white' 
                                            : 'bg-white border-gray-300'
                                    } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                                    rows={10} 
                                    placeholder="Paste your questions and answers here...&#10;&#10;Format:&#10;Q1) Your question here?&#10;Answer: Your answer here&#10;&#10;Q2) Another question?&#10;Answer: Another answer" />
                            </div>
                            
                            <div className="flex gap-3 pt-4">
                                <button onClick={onClose}
                                    className={`flex-1 py-3 rounded-xl border ${
                                        theme === 'dark' 
                                            ? 'border-gray-700 hover:bg-gray-800' 
                                            : 'border-gray-300 hover:bg-gray-100'
                                    } transition-colors font-medium`}>
                                    Cancel
                                </button>
                                <button onClick={handleImport} disabled={!importText.trim() || isProcessing}
                                    className="flex-1 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 transition-colors font-medium">
                                    {isProcessing ? 'Processing...' : 'Import Questions'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Provider Component
        function FlashCardsProvider({ children }) {
            const [state, setState] = useState({
                cards: [
                    {
                        id: '1',
                        question: 'Q1) Explain why MUST there be a safe system of work.',
                        answer: 'It is a LEGAL requirement under the HASWA 1974.',
                        category: 'Crane Operations',
                        tags: ['safety'],
                        difficulty: 'medium',
                        media: [],
                        created: new Date().toISOString(),
                        lastStudied: null,
                        nextReview: null,
                        timesStudied: 0,
                        timesCorrect: 0,
                        easeFactor: 2.5,
                        interval: 0,
                        repetitions: 0,
                        lapses: 0,
                    }
                ],
                categories: new Set(['Crane Operations']),
                studySessions: [],
                cardProgress: {},
                theme: 'dark',
                speechEnabled: true,
                autoReadEnabled: true, // Auto-read questions and answers
            });
            
            useEffect(() => {
                document.documentElement.classList.toggle('dark', state.theme === 'dark');
            }, [state.theme]);
            
            const addCard = (card) => {
                const newCard = {
                    ...card,
                    id: Date.now().toString(),
                    created: new Date().toISOString(),
                    lastStudied: null,
                    nextReview: null,
                    timesStudied: 0,
                    timesCorrect: 0,
                    easeFactor: 2.5,
                    interval: 0,
                    repetitions: 0,
                    lapses: 0,
                };
                setState(prev => ({
                    ...prev,
                    cards: [...prev.cards, newCard],
                    categories: new Set([...prev.categories, card.category].filter(Boolean)),
                }));
            };
            
            const importCards = (cards) => {
                setState(prev => ({
                    ...prev,
                    cards: [...prev.cards, ...cards],
                    categories: new Set([...prev.categories, ...cards.map(c => c.category)].filter(Boolean)),
                }));
            };
            
            const updateCard = (id, updates) => {
                setState(prev => ({
                    ...prev,
                    cards: prev.cards.map(card => 
                        card.id === id ? { ...card, ...updates } : card
                    ),
                    categories: updates.category 
                        ? new Set([...prev.categories, updates.category])
                        : prev.categories,
                }));
            };
            
            const deleteCard = (id) => {
                setState(prev => ({
                    ...prev,
                    cards: prev.cards.filter(card => card.id !== id),
                }));
            };
            
            const addStudySession = (session) => {
                setState(prev => ({
                    ...prev,
                    studySessions: [
                        ...prev.studySessions,
                        { ...session, id: Date.now().toString() },
                    ],
                }));
            };
            
            const toggleTheme = () => {
                setState(prev => ({
                    ...prev,
                    theme: prev.theme === 'dark' ? 'light' : 'dark',
                }));
            };
            
            const toggleAutoRead = () => {
                setState(prev => ({
                    ...prev,
                    autoReadEnabled: !prev.autoReadEnabled,
                }));
            };
            
            const value = {
                state, addCard, importCards, updateCard, deleteCard, addStudySession, toggleTheme, toggleAutoRead
            };
            
            return React.createElement(FlashCardsContext.Provider, { value }, children);
        }

        // Main App Component
        function MobileFlashCardsApp() {
            const { state, toggleTheme, toggleAutoRead, addCard, importCards, updateCard, deleteCard, addStudySession } = useFlashCards();
            const { theme, cards, categories, autoReadEnabled } = state;
            
            const [activeView, setActiveView] = useState('cards');
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('');
            const [showCardEditor, setShowCardEditor] = useState(false);
            const [editingCard, setEditingCard] = useState(undefined);
            const [isStudying, setIsStudying] = useState(false);
            const [showMenu, setShowMenu] = useState(false);
            const [showImportModal, setShowImportModal] = useState(false);
            
            const filteredCards = useMemo(() => {
                return cards.filter(card => {
                    const matchesSearch = !searchQuery || 
                        card.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        card.answer.toLowerCase().includes(searchQuery.toLowerCase());
                    const matchesCategory = !selectedCategory || card.category === selectedCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [cards, searchQuery, selectedCategory]);
            
            const handleStudyComplete = (results) => {
                addStudySession({
                    date: new Date().toISOString(),
                    duration: results.duration,
                    cardsStudied: results.correct + results.incorrect,
                    correctCount: results.correct,
                    mode: 'standard',
                });
                setIsStudying(false);
            };
            
            return (
                <div className={`min-h-screen ${theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`}>
                    {/* Header */}
                    <header className={`sticky top-0 z-40 ${
                        theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                    } border-b backdrop-blur-md bg-opacity-90`}>
                        <div className="px-4 py-3">
                            <div className="flex justify-between items-center">
                                <h1 className="text-xl font-bold">
                                    <span className="bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                                        Crane Operations üèóÔ∏è
                                    </span>
                                </h1>
                                
                                <div className="flex items-center gap-2">
                                    <button onClick={toggleTheme}
                                        className={`p-2 rounded-lg ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}>
                                        <Icon name={theme === 'dark' ? 'sun' : 'moon'} />
                                    </button>
                                    <button onClick={() => setShowMenu(!showMenu)}
                                        className={`p-2 rounded-lg ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}>
                                        <Icon name="menu" />
                                    </button>
                                </div>
                            </div>
                            
                            {activeView === 'cards' && !isStudying && (
                                <div className="mt-3">
                                    <div className="relative">
                                        <Icon name="search" className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                                        <input type="text" value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            placeholder="Search cards..."
                                            className={`w-full pl-10 pr-4 py-2 rounded-xl text-base ${
                                                theme === 'dark'
                                                    ? 'bg-gray-700 border-gray-600'
                                                    : 'bg-gray-100 border-gray-300'
                                            } border focus:outline-none focus:ring-2 focus:ring-blue-500`} />
                                    </div>
                                </div>
                            )}
                        </div>
                    </header>
                    
                    {/* Menu Dropdown */}
                    {showMenu && (
                        <div className="fixed inset-0 z-50" onClick={() => setShowMenu(false)}>
                            <div className={`absolute top-16 right-4 w-48 rounded-xl shadow-lg ${
                                theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                            } border overflow-hidden`}>
                                <button onClick={() => { setShowCardEditor(true); setShowMenu(false); }}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}>
                                    <Icon name="plus" className="w-4 h-4" />
                                    New Card
                                </button>
                                <button onClick={() => { setShowImportModal(true); setShowMenu(false); }}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}>
                                    <Icon name="upload" className="w-4 h-4" />
                                    Import Questions
                                </button>
                                {SpeechService.isSupported() && (
                                    <button onClick={() => { toggleAutoRead(); setShowMenu(false); }}
                                        className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}>
                                        <Icon name={autoReadEnabled ? "speaker" : "mute"} className="w-4 h-4" />
                                        Auto-Read: {autoReadEnabled ? 'ON' : 'OFF'}
                                    </button>
                                )}
                                <button onClick={() => { StorageService.exportData(state); setShowMenu(false); }}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}>
                                    üíæ Export Data
                                </button>
                            </div>
                        </div>
                    )}
                    
                    {/* Main Content */}
                    <main className="px-4 py-4 pb-20">
                        {activeView === 'cards' && !isStudying && (
                            <div className="space-y-4">
                                {filteredCards.length === 0 ? (
                                    <div className="text-center py-12">
                                        <Icon name="upload" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                                        <p className="text-lg mb-2">No cards found</p>
                                        <p className="text-gray-500 mb-4">Import your 73 crane questions or create new cards!</p>
                                        <div className="flex gap-3 justify-center">
                                            <button onClick={() => setShowImportModal(true)}
                                                className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium">
                                                Import Questions
                                            </button>
                                            <button onClick={() => setShowCardEditor(true)}
                                                className="px-6 py-3 border border-blue-500 text-blue-500 rounded-xl hover:bg-blue-50 font-medium">
                                                Create Card
                                            </button>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {filteredCards.map(card => (
                                            <MobileCardItem key={card.id} card={card}
                                                onEdit={() => { setEditingCard(card); setShowCardEditor(true); }}
                                                onDelete={() => { if (confirm('Delete this card?')) deleteCard(card.id); }}
                                                onStudy={() => { setIsStudying(true); setActiveView('study'); }} />
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {activeView === 'study' && !isStudying && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-center mb-6">Ready to Study? üìö</h2>
                                <div className={`p-6 rounded-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} text-center`}>
                                    <Icon name="brain" className="w-12 h-12 mx-auto mb-4 text-blue-500" />
                                    <h3 className="text-lg font-semibold mb-2">Crane Operations Study</h3>
                                    <p className={`text-sm mb-4 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>
                                        Practice your crane operation knowledge with speech support
                                    </p>
                                    <button onClick={() => setIsStudying(true)} disabled={filteredCards.length === 0}
                                        className="w-full py-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg font-medium">
                                        Start Studying ({filteredCards.length} cards)
                                    </button>
                                </div>
                            </div>
                        )}
                        
                        {(activeView === 'study' || activeView === 'cards') && isStudying && (
                            <MobileStudyMode cards={filteredCards} onComplete={handleStudyComplete} />
                        )}
                        
                        {activeView === 'stats' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-center">Your Progress üìä</h2>
                                <div className="grid grid-cols-2 gap-4">
                                    <div className={`p-4 rounded-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} text-center`}>
                                        <div className="text-2xl font-bold text-blue-500">{cards.length}</div>
                                        <div className="text-sm text-gray-500">Total Cards</div>
                                    </div>
                                    <div className={`p-4 rounded-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} text-center`}>
                                        <div className="text-2xl font-bold text-green-500">
                                            {cards.filter(c => c.timesCorrect > 0).length}
                                        </div>
                                        <div className="text-sm text-gray-500">Studied Cards</div>
                                    </div>
                                </div>
                                
                                {SpeechService.isSupported() && (
                                    <div className={`p-4 rounded-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} text-center`}>
                                        <Icon name={autoReadEnabled ? "speaker" : "mute"} className="w-8 h-8 mx-auto mb-2 text-blue-500" />
                                        <p className="text-sm text-gray-500">
                                            Auto-Read: {autoReadEnabled ? 'ON' : 'OFF'} üé§
                                        </p>
                                        <p className="text-xs text-gray-400 mt-1">
                                            {autoReadEnabled 
                                                ? 'Questions & answers read automatically' 
                                                : 'Click speaker icons to hear audio'
                                            }
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>
                    
                    {/* Card Editor Modal */}
                    {showCardEditor && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center p-4 z-50 overflow-y-auto">
                            <div className={`w-full max-w-lg my-8 rounded-2xl ${
                                theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                            } p-6`}>
                                <h2 className="text-xl font-semibold mb-6">
                                    {editingCard ? 'Edit Card ‚úèÔ∏è' : 'Create New Card ‚ûï'}
                                </h2>
                                <MobileCardEditor card={editingCard}
                                    onSave={(card) => {
                                        if (editingCard) {
                                            updateCard(editingCard.id, card);
                                        } else {
                                            addCard(card);
                                        }
                                        setShowCardEditor(false);
                                        setEditingCard(undefined);
                                    }}
                                    onCancel={() => {
                                        setShowCardEditor(false);
                                        setEditingCard(undefined);
                                    }} />
                            </div>
                        </div>
                    )}
                    
                    {/* Import Modal */}
                    {showImportModal && (
                        <ImportModal 
                            onClose={() => setShowImportModal(false)}
                            onImport={importCards}
                        />
                    )}
                    
                    {/* Bottom Navigation */}
                    <nav className={`fixed bottom-0 left-0 right-0 z-40 ${
                        theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                    } border-t`}>
                        <div className="flex justify-around py-2">
                            <button onClick={() => { setActiveView('cards'); setIsStudying(false); }}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'cards' && !isStudying 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                <Icon name="cards" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Cards</span>
                            </button>
                            <button onClick={() => { setActiveView('study'); setIsStudying(false); }}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'study' || isStudying 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                <Icon name="study" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Study</span>
                            </button>
                            <button onClick={() => { setActiveView('stats'); setIsStudying(false); }}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'stats' 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}>
                                <Icon name="stats" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Stats</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        }

        // Root App
        function App() {
            return React.createElement(FlashCardsProvider, null, React.createElement(MobileFlashCardsApp));
        }

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
