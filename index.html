<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1f2937">
    <title>Flash Cards Pro v6.1</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎯</text></svg>">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
        }
        html, body { 
            margin: 0; 
            padding: 0; 
            width: 100%; 
            height: 100%; 
            overflow-x: hidden; 
            font-family: system-ui, -apple-system, sans-serif;
        }
        #root {
            min-height: 100vh;
        }
        .perspective-1000 { perspective: 1000px; }
        .transform-style-preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .line-clamp-2 { 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
        }
        button:active { transform: scale(0.98); }
        
        /* Enhanced Animation Keyframes */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px) translateX(-50%);
            }
            to {
                opacity: 1;
                transform: translateY(0) translateX(-50%);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 0.9;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-8px,0);
            }
            70% {
                transform: translate3d(0,-4px,0);
            }
            90% {
                transform: translate3d(0,-2px,0);
            }
        }
        
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        
        @media screen and (max-width: 768px) { 
            input, textarea, select { font-size: 16px !important; } 
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, createContext, useContext, useRef } = React;

        // Simple Icons
        const Icon = ({ name, className = "w-5 h-5" }) => {
            const icons = {
                search: "🔍", plus: "➕", moon: "🌙", sun: "☀️", menu: "☰",
                cards: "🎴", study: "📚", stats: "📊", edit: "✏️", delete: "🗑️",
                check: "✅", x: "❌", clock: "⏰", volume: "🔊", brain: "🧠",
                zap: "⚡", target: "🎯", trend: "📈", points: "🏆"
            };
            
            return React.createElement('span', {
                className: `inline-block ${className}`,
                style: { fontSize: '1.2em' }
            }, icons[name] || "📝");
        };

        // Enhanced Text-to-Speech Service
        class SpeechService {
            static currentUtterance = null;
            static isPlaying = false;
            
            static speak(text, settings = {}) {
                if (!('speechSynthesis' in window) || !settings.speechEnabled) return;
                
                // Always cancel any ongoing speech first
                this.stop();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = settings.speechRate || 1.0;
                utterance.volume = 0.8;
                
                // Use selected voice if available
                if (settings.speechVoice) {
                    const voices = window.speechSynthesis.getVoices();
                    const selectedVoice = voices.find(voice => voice.name === settings.speechVoice);
                    if (selectedVoice) {
                        utterance.voice = selectedVoice;
                    }
                }
                
                // Track the current utterance and state
                this.currentUtterance = utterance;
                this.isPlaying = true;
                
                // Handle speech events
                utterance.onend = () => {
                    this.currentUtterance = null;
                    this.isPlaying = false;
                };
                
                utterance.onerror = () => {
                    this.currentUtterance = null;
                    this.isPlaying = false;
                };
                
                utterance.onstart = () => {
                    this.isPlaying = true;
                };
                
                window.speechSynthesis.speak(utterance);
            }
            
            static stop() {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    this.currentUtterance = null;
                    this.isPlaying = false;
                }
            }
            
            static estimateSpeechDuration(text, rate = 1.0) {
                // Rough estimate: ~150 words per minute at normal rate
                const words = text.split(' ').length;
                const baseWPM = 150;
                const adjustedWPM = baseWPM * rate;
                return (words / adjustedWPM) * 60 * 1000; // Convert to milliseconds
            }
        }

        // Continuous Study Service for Auto-Play Mode
        class ContinuousStudyService {
            static queue = [];
            static isProcessing = false;
            static currentTimeout = null;
            static onPhaseChange = null;
            static onComplete = null;
            static isPaused = false;
            static settings = null;
            
            static start(onPhaseChange, onComplete, settings) {
                this.onPhaseChange = onPhaseChange;
                this.onComplete = onComplete;
                this.settings = settings;
                this.isPaused = false;
                this.queue = [];
                this.isProcessing = false;
            }
            
            static addToQueue(text, pauseAfter = 1000, phase = null) {
                this.queue.push({ text, pauseAfter, phase });
                if (!this.isProcessing && !this.isPaused) {
                    this.processQueue();
                }
            }
            
            static processQueue() {
                if (this.isPaused || this.queue.length === 0) {
                    if (this.queue.length === 0) {
                        this.isProcessing = false;
                        if (this.onComplete) this.onComplete();
                    }
                    return;
                }
                
                this.isProcessing = true;
                const { text, pauseAfter, phase } = this.queue.shift();
                
                // Notify phase change
                if (this.onPhaseChange && phase) {
                    this.onPhaseChange(phase);
                }
                
                // Speak the text
                SpeechService.speak(text, this.settings);
                
                // Calculate total wait time (speech duration + pause)
                const speechDuration = SpeechService.estimateSpeechDuration(text, this.settings.speechRate);
                const totalWaitTime = speechDuration + pauseAfter;
                
                this.currentTimeout = setTimeout(() => {
                    if (!this.isPaused) {
                        this.processQueue();
                    }
                }, totalWaitTime);
            }
            
            static pause() {
                this.isPaused = true;
                SpeechService.stop();
                if (this.currentTimeout) {
                    clearTimeout(this.currentTimeout);
                    this.currentTimeout = null;
                }
            }
            
            static resume() {
                this.isPaused = false;
                this.processQueue();
            }
            
            static stop() {
                this.isPaused = true;
                this.isProcessing = false;
                this.queue = [];
                SpeechService.stop();
                if (this.currentTimeout) {
                    clearTimeout(this.currentTimeout);
                    this.currentTimeout = null;
                }
            }
        }

        // Context
        const FlashCardsContext = createContext(null);
        const useFlashCards = () => {
            const context = useContext(FlashCardsContext);
            if (!context) throw new Error('useFlashCards must be used within FlashCardsProvider');
            return context;
        };

        // Storage Service
        class StorageService {
            static STORAGE_KEY = 'flashcards-pro-v61-continuous';
            static VERSION = '6.1';
            
            static save(state) {
                try {
                    const data = { 
                        ...state, 
                        categories: Array.from(state.categories),
                        version: this.VERSION 
                    };
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(data));
                } catch (error) {
                    console.error('Failed to save data:', error);
                }
            }
            
            static load() {
                try {
                    const data = localStorage.getItem(this.STORAGE_KEY);
                    if (!data) return null;
                    const parsed = JSON.parse(data);
                    return { ...parsed, categories: new Set(parsed.categories || []) };
                } catch (error) {
                    console.error('Failed to load data:', error);
                    return null;
                }
            }
            
            static exportData(state) {
                const data = {
                    version: this.VERSION,
                    exported: new Date().toISOString(),
                    ...state,
                    categories: Array.from(state.categories),
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `flashcards-v${this.VERSION}-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            }
            
            static async importData(file, onSuccess, onError) {
                try {
                    const text = await file.text();
                    
                    // Try to parse as JSON first
                    let data;
                    try {
                        data = JSON.parse(text);
                        if (data.cards && Array.isArray(data.cards)) {
                            onSuccess(data);
                            return;
                        }
                    } catch (e) {
                        // Not JSON, try parsing as Q&A text format
                    }
                    
                    // Parse Q&A text format
                    const cards = this.parseQAText(text);
                    if (cards.length > 0) {
                        const importData = {
                            cards,
                            categories: new Set(['Theory Questions']),
                            studySessions: [],
                            cardProgress: {},
                        };
                        onSuccess(importData);
                    } else {
                        onError('No valid questions found in file');
                    }
                } catch (error) {
                    onError('Failed to read file: ' + error.message);
                }
            }
            
            static parseQAText(text) {
                const cards = [];
                const lines = text.split('\n');
                let currentQuestion = '';
                let currentAnswer = '';
                let isAnswer = false;
                let questionNumber = 1;
                let currentPoints = 1;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // Check if this is a question line (starts with Q followed by number)
                    if (line.match(/^Q\d+\)/)) {
                        // Save previous card if exists
                        if (currentQuestion && currentAnswer) {
                            // Extract points from the complete question text before saving
                            const fullQuestionPoints = currentQuestion.match(/\((\d+)pt\)/);
                            if (fullQuestionPoints) {
                                currentPoints = parseInt(fullQuestionPoints[1]);
                            }
                            
                            cards.push({
                                id: questionNumber.toString(),
                                question: currentQuestion.replace(/\(\d+pt\)/, '').trim(),
                                answer: currentAnswer.trim(),
                                category: 'Theory Questions',
                                tags: [],
                                points: currentPoints,
                                media: [],
                                created: new Date().toISOString(),
                                lastStudied: null,
                                nextReview: null,
                                timesStudied: 0,
                                timesCorrect: 0,
                                easeFactor: 2.5,
                                interval: 0,
                                repetitions: 0,
                                lapses: 0
                            });
                            questionNumber++;
                        }
                        
                        // Start new question
                        currentQuestion = line;
                        currentAnswer = '';
                        isAnswer = false;
                        currentPoints = 1; // Reset to default
                    } else if (line.startsWith('Answer:')) {
                        isAnswer = true;
                        currentAnswer = line.replace('Answer:', '').trim();
                    } else if (line.length > 0) {
                        if (!isAnswer && currentQuestion && !line.match(/^Q\d+\)/)) {
                            // Check if this line contains points notation
                            const pointsMatch = line.match(/\((\d+)pt\)/);
                            if (pointsMatch || currentQuestion.includes('?') || currentQuestion.includes(' and ')) {
                                // This is still part of the question
                                currentQuestion += (currentQuestion ? '\n' : '') + line;
                            } else {
                                // This might be the start of an answer without "Answer:" prefix
                                isAnswer = true;
                                currentAnswer = line;
                            }
                        } else if (isAnswer) {
                            currentAnswer += (currentAnswer ? '\n' : '') + line;
                        } else {
                            currentQuestion += (currentQuestion ? '\n' : '') + line;
                        }
                    }
                }
                
                // Don't forget the last card
                if (currentQuestion && currentAnswer) {
                    // Extract points from the complete question text
                    const fullQuestionPoints = currentQuestion.match(/\((\d+)pt\)/);
                    if (fullQuestionPoints) {
                        currentPoints = parseInt(fullQuestionPoints[1]);
                    }
                    
                    cards.push({
                        id: questionNumber.toString(),
                        question: currentQuestion.replace(/\(\d+pt\)/, '').trim(),
                        answer: currentAnswer.trim(),
                        category: 'Theory Questions',
                        tags: [],
                        points: currentPoints,
                        media: [],
                        created: new Date().toISOString(),
                        lastStudied: null,
                        nextReview: null,
                        timesStudied: 0,
                        timesCorrect: 0,
                        easeFactor: 2.5,
                        interval: 0,
                        repetitions: 0,
                        lapses: 0
                    });
                }
                
                return cards;
            }
        }

        // Parse points from question text
        const parsePointsFromQuestion = (questionText) => {
            const match = questionText.match(/\((\d+)pt\)/);
            return match ? parseInt(match[1]) : 1;
        };

        // Remove points notation from question text
        const cleanQuestionText = (questionText) => {
            return questionText.replace(/\(\d+pt\)/, '').trim();
        };

        // Card Data - Parse from the new format with points
        const createDefaultCards = () => {
            const rawData = `
Q1)Explain why MUST there be a safe system of work.(3pt)
Answer: It is a LEGAL requirement under the HASWA 1974.

Q2)a) State the legislation and the regulation therein that refers to the stability of cranes and b) Which regulation states the requirement for all lifting operations to be properly planned?(2pt)
Answer: a) LOLER Regulation 4
b) LOLER Regulation 8

Q3) a) State the regulation number for the lifting of persons under LOLER 1998 and b) List FIVE requirements to be within a procedure.(6pt)
Answer: a)LOLER Regulation 5
b) 1. Has suitable devices to prevent the risk of carrier falling
2. A person trapped in any carrier can be freed
3. The carrier has an enhanced safety coefficient suspension rope or chain
4. The rope or chain is inspected by a competent person every working day
5. The use of carrier clearly marked for personnel use

Q4)a) What is the 'Factor of Safety' when lifting personnel and
b) What needs to be taken into account with wind speeds?(1pt)
Answer: a) 2:1
b) maximum wind speeds of 7m/s

Q5)How does the guidance in LOLER 1998 (L 113) describe the difference between installed and positioned?(4pt)
Answer: Installed – fixed in location (tower crane)
Positioned – manoeuvred in to place (mobile crane)

Q6)a) What is the minimum recommended distance that is allowed between the counterweight(s) of any lifting equipment and an object/structure and
b) What measure must be taken if the distance is less?(4pt)
Answer: a) Minimum 600 mm.
b) Prevent access

Q7)Who has overall control of the lifting operation?(1pt)
Answer: The Appointed Person

Q8)What IS the definition of a competent person as stated by Codes of Practice?(1pt)
Answer: A person who has practical and theoretical knowledge as well as planning experience of crane and equipment.

Q9)Which part of BS 7121 is specific to mobile cranes?(1pt)
Answer: Sections 2-3

Q10)When a crane company hires out a crane, name TWO main legal requirements the hire company must meet regarding the crane and operator.(2pt)
Answer: 1. A competent trained operator
2. Correct and up-to-date certification

Q11)Explain the difference between an employing and user organisation.(2pt)
Answer: Employing Organisation requires the load to be lifted 
User Organisation and plan and manoeuvres the lift for the client.

Q12)Who is responsible for providing the contractor with written details of the work to be done?(1pt)
Answer: The Employing Organisation

Q13)Where would the information relating to the additional requirements of an intermediate lift over a basic lift be sought?(1pt)
Answer: Explained in BS 7121, 4.3.2 for basic lift, 4.3.3. for intermediate/standard lift

Q14)To whom should the appointed person give all details involving the lifting
operation?(1pt)
Answer: Crane supervisor and anyone involved.

Q15)Why is it recommended to complete a report after the completion of the lifting operation?(2pt)
Answer: To evaluate the lifting operation where good practice can be utilized in future lifts or where the operation could have been planned more effectively. The client/contractor may further require written feedback on the operation.

Q16)A change of crane lifting equipment operator is required. What must they be made aware of before continuing?(2pt)
Answer: The lift plan and any other relevant issue.

Q17) Name TWO duties of the crane operator.(2pt)
Answer: I. Operate crane according to manufactures instructions
2. Implement the lift plan and safe system of work

Q18)Describe FOUR factors that need to be taken into account when specifying communication procedures for a lifting operation.(4pt)
Answer: 1. Communication method established before the lift
2. Banksman/Signaller shall be visible/audible at all times
3. The operator shall obey stop signals whoever gives them
4. The Person in Charge shall be clearly identified and made known to all members of the lift team and personnel in the proximity.

Q19)If radios are to be used during the lifting operations, what FIVE actions and checks must be made before use?(5pt)
Answer: 1. Check if people involved know how to use them
2. Check if batteries will last for the duration of the operation or spare batteries are supplied
3. Check if all involved in the lifting are on the same frequency (channel)
4. Check if the signal strength is sufficient
5. Check if the frequency is clear from other interferences

Q20)Name the FOUR stages of the hierarchy of control for the marshalling of mobile lifting equipment.(4pt)
Answer: 1. Elimination/substitution
2. Engineering
3. Administration
4. PPE

Q21)Name THREE factors to be taken into account when devising a mobile lifting equipment marshalling plan.(3pt)
Answer: 1. Visibility
2. Attaching / Detaching and securing loads
3. Environment

Q22)Name THREE possible effects that fatigue can have on a lifting team (3pt)
Answer: 1. Decreased productivity
2. Reduced safe working ability
3. Absenteeism

Q23)Name SIX principle factors should be taken into account in relation to
fatigue management of a lifting operation.(6pt)
Answer: 1. Comply with your organization's policies and procedures relating fatigue
2. Understand your sleep, rest and recovery needs and obtain adequate rest and sleep away from work
3. Seek medical advice and assistance if you have a concern about a health condition that affects your sleep or causes fatigue
4. Look out for signs of fatigue at the people you work with
5. In consultations with your supervisor, take steps to manage fatigue
6. Maintain hydration

Q24)State THREE occasions on which lifting equipment must be thoroughly examined.(3pt)
Answer: 1. When lifting equipment is first supplied (used for the first time by the
employer)
2. When certain equipment is installed (e.g. tower crane)
3. Periodically during the lifetime of the equipment
4. Following exceptional circumstances

Q25)How long is a thorough examination for a lifting accessory valid for?(1pt)
Answer: 6 months.

Q26)Name FOUR items that must be recorded when a thorough examination on a lifting appliance has been carried out.(4pt)
Answer: 1. Defects
2. SWL
3. Model of the machine
4. Examination location

Q27)List TWO methods of obtaining the accurate weight of a load.(2pt)
Answer: 1. Manufacturer's data
2. Trial lift (using a weight load cell)

Q28)During dismantling operations, what factor of safety is applied to the load?(1pt)
Answer: Minimum of 20%

Q29)If an object has to be dismantled above ground to be lifted to ground level (and can't be returned to the original position), what factor of safety should be applied?(1pt)
Answer: 2:1

Q30)Name THREE factors(configurations) that determine the rated lifting capacity of lifting equipment.(3pt)
Answer: 1. Boom angle
2. Spread of outriggers
3. The radius

Q31)What does the term 'structural strength' relate to with regard to the lifting capacity of any lifting equipment?(1pt)
Answer: Structural strength refers to where the maximum SWL is limited by the structural strength of all relevant components. Example boom, outriggers, slew ring, chassis .

Q32)Name the sections in 7121 where advice is given on 'Lifting without outriggers' and 'Pick and carry'.(1pt)
Answer: 12.1.5 Lifting without outriggers
12.1.6 Pick and Carry

Q33)Define the term 'radius'.(1pt)
Answer: The radius is the horizontal distance between the points at which the centre of rotation meets the ground and the vertical centre line passing through the load lifting attachment.

Q34)If a crane is out of level, what effect will it have on the radius?(2pt)
Answer: Increase on low side, decrease on high side.

Q35)What is the definition of the term "outreach"?(1pt)
Answer: The horizontal measurement from the centre of the hook block to the nearest part of the crane (excluding boom).

Q36)If a load of 20 tonnes is lifted on four falls of rope, what is the tension in each fall?(1pt)
Answer: 20 tonnes / 4 falls = 5 tonnes each fall

Q37)What advantage is gained by increasing the number of falls on a hook block?(1pt)
Answer: Increasing the falls could increase lifting capacity (for a particular configuration).

Q38)State the safe procedure to be followed before lifting or lowering a load down a shaft or excavation.(2pt)
Answer: The empty hook must be lowered down to working level and the hoist drum checked for sufficient turns on the drum.

Q39)When planning a lifting operation to place loads below ground level, what needs to be taken into account when calculating the gross weight of the load?(2pt)
Answer: The weight of the rope below ground level will need to be factored into the gross weight of the load.

Q40)Explain the purpose of the over-hoist limit switch?(1pt)
Answer: To stop the hook from hitting the boom head.

Q41)What are the types of warning indicated by RCI and at what point are they activated?(2pt)
Answer: AMBER 90-97.6%
RED light with external alarm 102.5-110%

Q42)a) Where would the duty board of a tower crane normally be located and
b) Name FOUR types of information that it must contain (5pt)
Answer: a) Located at the base of the tower crane
b)
1. Make
2. Model
3. Serial number
4. Capacity at maximum radius

Q43)How could the deflection of a boom or jib on a mobile-type crane affect a lift? (2pt)
Answer: The boom deflection can cause an increase in the radius.

Q44)Why must a lifting equipment operator never try to,' and 'drag' a load? (2pt)
Answer: Because it can induce side loading on the boom (for which it wasn't designed) and can cause structural failure.

Q45)On mobile and crawler cranes, in what situation can a single load be lifted using the fly jib hook block & min book hook block simultaneously?(1pt)
Answer: If it is stated by the manufacturer.

Q46)On both tracked and wheeled 360 degree excavators:(2pt)
a) What differs between lifting over the side of the machine compared to lifting the front or the rear of the machine?
b) Explain why.
Answer: a) Increased stability when lifting over the front and back, over the side a reduction of capacity
b) Reduced stability base

Q47)Name FOUR factors relating to ground that a ground engineer would need to taken into account when determining the load bearing capacity of ground (4pt)
Answer: 1. Ability of the ground to support the gross weight of the machine and load
2. Integrity of adjacent ground to withstand lateral stresses imposed
3. Levelling and preparation
4. Underground services

Q48)The area of mat size has been correctly specified for use with the outriggers of a mobile crane and the intended load and operating radius but the pad not stiff or rigid enough (e.g. it is too thin). Explain the possible consequence.(2pt)
Answer: The mat will be unable to spread the outrigger point load uniformly and will risk sinking in and destabilizing the crane.

Q49)Identify FOUR requirements for ensuring the stability of mobile cranes on site.(4pt)
Answer: 1. Firm/level standing
2. All outriggers extended accordingly
3. Crane level both longitudinally and transversely
4. All wheels clear of the ground
5. Crane not overloaded

Q50)Outline the role of the Temporary Works Coordinator.(2pt)
Answer: 1. Co-ordinate all temporary works activities
2. Ensure a temporary works register is established and maintained
3. Ensure that responsibilities are accepted
4. Ensure that a design brief is prepared with the actual situation on site

Q51)Who is responsible for compiling all necessary documentation when lifting close proximity to a site boundary? E.g. protection fans?(1pt)
Answer: Temp works coordinator

Q52)A platform is being used to receive lifted loads of materials. What primary procedure must be in place to ensure that the platform being used is suitable and sufficient to hold the weight of the load?(1pt)
Answer: Temporary works design.

Q53)What are the THREE key fundamental aspects that need considering when preparing a design for any temporary works design/structure?(3pt)
Answer: 1. foundation
2. structure
3. stability

Q54)List FOUR items of information that must be included on a temporary works register.(4pt)
Answer: 1. Design Checker
2. Date design complete
3. Date design checked/approved
4. Erection complete and checked or "Permit to Load", "Permit to Dismantle"

Q55)a) What is the recommended minimum exclusion zone around overhead power lines,(6pt)
b) Where can this information be sourced and
c) Explain why a distance from overhead power lines should be kept.
Answer: a) 	275KW-400KW 7M
	132KW 6M
	11KW-33KW 3M
	Low voltage 1M
b) BS6 HSE
c) Because electricity can arch across large gaps

Q56)When planning a lift near a slope, what is the minimum distance to be kept between the supporting components of the lifting equipment and the slope?(2pt)
Answer: Edge of the mat to the edge of the slope should be double of height of slope.

Q57)If planning to lift loads In or near a pedestrianized area, what main factor needs to be taken into account?(2pt)
Answer: Physical segregation of pedestrians from overhead loads. Create an exclusion zone.

Q58)Two cranes are working in the same vicinity that encroach the operating radius of each. What actions should the lift plan or method statement normally specify?(3pt)
Answer: Have crane coordinator in place or anti-collision and crash radios.

Q59)In what circumstances would aviation warning lighting be required to high -type lifting equipment?(2pt)
Answer: If the lifting equipment is within 6km of an aerodrome and the overall height exceeds 10 metres above nearby existing structures and trees.

Q60)Identify 4 types of infrastructure where a responsible body or owner would have to be notified when planning a lift on or near by.(4pt)
Answer: 1. Rivers
2. Airfields
3. Highways
4. Railways
5. Live plant

Q61)Name a design of accessory hook that is exempt from being fitted with a safety catch.(1pt)
Answer: A 'C' type Hook.

Q62)Name THREE markings found on multiple-leg slings.(3pt)
Answer: 1. SWL (WLL)
2. Manufactures name
3. Serial number

Q63)State the maximum recommended included angle for single-leg slings when used as a pair.(1pt)
Answer: Maximum 90 degrees.

Q64)Give TWO methods of obtaining the centre of gravity on an unbalanced load.(2pt)
Answer: 1. Calculation
2. Trial lift

Q65)In which applications are single leg slings rated with their own SWL (WLL)?(1pt)
Answer: Only when used vertically.

Q66)How is the SWL/WLL/rated capacity for multi-legs slings determined?(1pt)
Answer: By the Uniform Load method.

Q67)To lift a load of 20 tonnes on a 4 single leg chain sling, what is the required SWL (WLL) for each leg with an included angle of 87 degrees?(4pt)
Please explain your calculation.
Answer: 1. 9.52 tonnes/each leg
2. When using 4 leg chain sling the same calculation as 3 leg chain sling is used because it is considered that not all 4 legs are taking the weight equal. So: 20 tonnes divided by 2.1 (mod factor for 3 legs and 87 degrees angle) = 9.52 tonne each leg. 4x10 slings needed.

Q68)How should multiple accessories be connected to a crane hook?(1pt)
Answer: Using a master ring and bow shackles.

Q69)State SIX environmental factors that can affect an external lifting operation.(6pt)
Answer: 1. wind
2. Fog
3. Mist
4. Excessive rain
5. Lightning
6. Storms
7. Ice and snow

Q70)Name FOUR factors should be taken into account when calculating the effects of wind on a crane-based lifting operation(4pt)
Answer: 1. The geometry and shape of the load
2. The height to which the load is to be lifted
3. The wind direction
4. Operating between structures

Q71)Give THREE examples of how excessive rain can affect an external lifting operation when using lifting equipment.(3pt)
Answer: 1. Excessive rain can cause the ground to soften reducing the crane support
2. Poor visibility
3. Cause slippery conditions and reduce traction

Q72) Outline THREE principle requirements for out of service procedures for tower cranes.(3pt)
Answer: 1. Remove accessories and jib in free slew
2. Out of radius of other cranes and obstructions
3. Lock up and isolate crane

Q73)Using the given lifting capacity diagram for the JC8 525/125 telescopic handler using a hook (A61):(4pt)
a) What is the maximum lifting capacity?
b) What is the maximum lifting capacity when free on wheels (FOW)
c) What the maximum hook height where a load can be lifted
d) What is the maximum lifting capacity when the hook is at a height of 8m and the boom at an angle of 4Sdegrees?
Answer: a) 3500 kg
ab) 0kg
ac) 10m
ad) 1000kg

Q74)What does the helth and safety at work act require employers to do regards spcificaly to plant?(3pt)
Answer: Provide and maintain plant that is safe and without risk to health so far as is resonably practicable.

Q75) Name two possible penalties for not folowing local requirements. (2pt)
Answer: fines or imprisonment

Q76) When planning a lift for a lory loader activity and where it is adjacent to a slope, what is regarded as the minimum distance to be kept from a  sloped edge?(2pt)
Answer: The horizonal distance from the foot to the top of the slope should be at least the distance from the top of the slope to the lory.

Q77) What is the main aim of HASWA 1974 ? (2pt)
Answer: To create a safe system of work.

Q78) What is a load radious indicator?(1pt)
Answer: A divice fitted to a crane that shows the radius at witch the crane is operating and is coresponding SWL (WLL)
            `;
            
            return StorageService.parseQAText(rawData);
        };

        // Points color scheme
        const getPointsColor = (points) => {
            if (points <= 2) return 'bg-green-500 text-white';
            if (points <= 4) return 'bg-blue-500 text-white';
            return 'bg-red-500 text-white';
        };

        // Mobile Card Component
        function MobileCardItem({ card, onEdit, onDelete, onStudy }) {
            const { state: { theme } } = useFlashCards();
            const [showActions, setShowActions] = useState(false);
            
            return (
                <div className={`relative mb-3 rounded-xl border transition-all cursor-pointer ${
                    theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                }`}>
                    <div className="p-4" onClick={() => setShowActions(!showActions)}>
                        <div className="flex justify-between items-start mb-2">
                            <h4 className="font-medium text-base leading-tight pr-2 flex-1">{card.question}</h4>
                            <span className={`text-xs px-2 py-1 rounded flex-shrink-0 flex items-center gap-1 ${getPointsColor(card.points || 1)}`}>
                                <Icon name="points" className="w-3 h-3" />
                                {card.points || 1}pt
                            </span>
                        </div>
                        
                        <p className={`text-sm mb-3 line-clamp-2 ${
                            theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                        }`}>
                            {card.answer}
                        </p>
                        
                        <div className="flex flex-wrap gap-1">
                            {card.category && (
                                <span className={`text-xs px-2 py-1 rounded ${
                                    theme === 'dark' ? 'bg-blue-900 text-blue-300' : 'bg-blue-100 text-blue-700'
                                }`}>
                                    {card.category}
                                </span>
                            )}
                            {card.tags.slice(0, 2).map(tag => (
                                <span key={tag} className={`text-xs px-2 py-1 rounded ${
                                    theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'
                                }`}>
                                    {tag}
                                </span>
                            ))}
                        </div>
                    </div>
                    
                    <div className={`overflow-hidden transition-all duration-300 ${
                        showActions ? 'max-h-16' : 'max-h-0'
                    }`}>
                        <div className={`flex border-t ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                            <button
                                onClick={(e) => { e.stopPropagation(); onStudy(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium text-blue-500 ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                } border-r ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}
                            >
                                Study
                            </button>
                            <button
                                onClick={(e) => { e.stopPropagation(); onEdit(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                } border-r ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}
                            >
                                Edit
                            </button>
                            <button
                                onClick={(e) => { e.stopPropagation(); onDelete(); }}
                                className={`flex-1 py-3 px-4 text-sm font-medium text-red-500 ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-50'
                                }`}
                            >
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Mobile Study Card with Fullscreen
        function MobileStudyCard({ card, isFlipped, onFlip, isFullscreen, onToggleFullscreen }) {
            const { state: { theme, settings } } = useFlashCards();
            const speechTimeoutRef = useRef(null);
            const lastCardIdRef = useRef(null);
            const lastFlippedRef = useRef(null);
            
            // Clean question text by removing Q1), Q2), etc.
            const cleanQuestion = card.question.replace(/^Q\d+\)\s*/, '');
            
            // Clear speech function
            const clearSpeech = useCallback(() => {
                SpeechService.stop();
                if (speechTimeoutRef.current) {
                    clearTimeout(speechTimeoutRef.current);
                    speechTimeoutRef.current = null;
                }
            }, []);
            
            // Speech effect
            useEffect(() => {
                clearSpeech();
                
                if (!settings.speechEnabled) return;
                
                const isCardChange = lastCardIdRef.current !== card.id;
                const isFlipChange = lastFlippedRef.current !== isFlipped;
                
                lastCardIdRef.current = card.id;
                lastFlippedRef.current = isFlipped;
                
                if (isCardChange) {
                    if (settings.autoReadQuestion) {
                        speechTimeoutRef.current = setTimeout(() => {
                            if (lastCardIdRef.current === card.id && !isFlipped) {
                                SpeechService.speak(cleanQuestion, settings);
                            }
                            speechTimeoutRef.current = null;
                        }, 300);
                    }
                    return;
                }
                
                if (isFlipChange) {
                    const delay = 500;
                    speechTimeoutRef.current = setTimeout(() => {
                        if (lastCardIdRef.current === card.id && lastFlippedRef.current === isFlipped) {
                            if (isFlipped && settings.autoReadAnswer) {
                                SpeechService.speak(card.answer, settings);
                            } else if (!isFlipped && settings.autoReadQuestion) {
                                SpeechService.speak(cleanQuestion, settings);
                            }
                        }
                        speechTimeoutRef.current = null;
                    }, delay);
                }
            }, [card.id, isFlipped, settings.speechEnabled, settings.autoReadQuestion, settings.autoReadAnswer, clearSpeech, cleanQuestion]);
            
            useEffect(() => {
                return () => {
                    clearSpeech();
                };
            }, [clearSpeech]);
            
            const handleCardClick = () => {
                clearSpeech();
                onFlip();
            };
            
            return (
                <div className={`relative w-full ${isFullscreen ? 'h-screen' : 'h-[28rem]'} perspective-1000`}>
                    <div 
                        className={`relative w-full h-full transition-transform duration-500 transform-style-preserve-3d cursor-pointer ${
                            isFlipped ? 'rotate-y-180' : ''
                        }`}
                        onClick={handleCardClick}
                    >
                        <div className={`absolute inset-0 backface-hidden rounded-2xl p-8 flex flex-col ${
                            theme === 'dark' 
                                ? 'bg-gradient-to-br from-gray-800 to-gray-900 text-white' 
                                : 'bg-gradient-to-br from-white to-gray-100'
                        } shadow-xl border ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                            
                            <div className="absolute top-4 left-4">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onToggleFullscreen();
                                    }}
                                    className={`p-2 rounded-lg ${
                                        theme === 'dark' ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'
                                    }`}
                                >
                                    {isFullscreen ? '↙️' : '↗️'}
                                </button>
                            </div>
                            
                            {/* Subtle points badge */}
                            <div className="absolute top-4 right-4">
                                <span className={`text-xs px-2 py-1 rounded-full opacity-50 ${
                                    theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'
                                }`}>
                                    {card.points || 1}pt
                                </span>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto px-2 py-4 flex items-center justify-center">
                                <div className="text-center w-full">
                                    <h2 className={`${isFullscreen ? 'text-2xl' : 'text-lg'} font-medium leading-relaxed`}>{cleanQuestion}</h2>
                                </div>
                            </div>
                            
                            <div className="text-center text-sm opacity-70 flex-shrink-0 mt-6">
                                Tap to reveal answer
                            </div>
                        </div>
                        
                        <div className={`absolute inset-0 backface-hidden rotate-y-180 rounded-2xl p-8 flex flex-col ${
                            theme === 'dark' 
                                ? 'bg-gradient-to-br from-blue-900 to-blue-800 text-white' 
                                : 'bg-gradient-to-br from-blue-50 to-blue-100'
                        } shadow-xl border ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                            
                            <div className="absolute top-4 left-4">
                                <button
                                    onClick={(e) => {
                                        e.stopPropagation();
                                        onToggleFullscreen();
                                    }}
                                    className={`p-2 rounded-lg ${
                                        theme === 'dark' ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'
                                    }`}
                                >
                                    {isFullscreen ? '↙️' : '↗️'}
                                </button>
                            </div>
                            
                            {/* Subtle points badge */}
                            <div className="absolute top-4 right-4">
                                <span className={`text-xs px-2 py-1 rounded-full opacity-50 ${
                                    theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'
                                }`}>
                                    {card.points || 1}pt
                                </span>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto px-2 py-4 flex items-start justify-center">
                                <div className="text-center w-full">
                                    <h2 className={`${isFullscreen ? 'text-2xl' : 'text-lg'} font-medium leading-relaxed whitespace-pre-line`}>{card.answer}</h2>
                                </div>
                            </div>
                            
                            <div className="text-center text-sm opacity-70 flex-shrink-0 mt-6">
                                Tap to show question
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Fullscreen Study Mode with Enhanced Animations and Gestures
        function FullscreenStudyMode({ cards, currentIndex, isFlipped, onFlip, onNavigate, onExit }) {
            const { state: { theme, settings } } = useFlashCards();
            const touchStartRef = useRef({ x: 0, y: 0 });
            const touchEndRef = useRef({ x: 0, y: 0 });
            const [showHints, setShowHints] = useState(true);
            const [slideDirection, setSlideDirection] = useState('');
            const [isSliding, setIsSliding] = useState(false);
            const [animationPhase, setAnimationPhase] = useState('idle'); // 'idle', 'slide-out', 'slide-in'
            const [isTransitioning, setIsTransitioning] = useState(false); // For fade transition
            const [dragOffset, setDragOffset] = useState(0); // For peek animation
            const [isDragging, setIsDragging] = useState(false);
            
            const currentCard = cards[currentIndex];
            const hasNext = currentIndex < cards.length - 1;
            const hasPrev = currentIndex > 0;
            const nextCard = hasNext ? cards[currentIndex + 1] : null;
            const prevCard = hasPrev ? cards[currentIndex - 1] : null;
            
            // Clean question text by removing Q1), Q2), etc.
            const cleanQuestion = currentCard.question.replace(/^Q\d+\)\s*/, '');
            
            // Peek thresholds
            const PEEK_THRESHOLD = 50; // Minimum drag for peek
            const NAVIGATE_THRESHOLD = 120; // Minimum drag for navigation
            
            // Hide hints after 3 seconds
            useEffect(() => {
                const timer = setTimeout(() => setShowHints(false), 3000);
                return () => clearTimeout(timer);
            }, [currentIndex]);
            
            // Reset drag offset when navigation happens
            useEffect(() => {
                setDragOffset(0);
                setIsDragging(false);
            }, [currentIndex]);
            
            // Reset drag offset when card flips
            useEffect(() => {
                setDragOffset(0);
            }, [isFlipped]);
            
            // Speech effect for fullscreen mode
            useEffect(() => {
                SpeechService.stop();
                
                if (settings.speechEnabled && !isSliding && animationPhase === 'idle') {
                    setTimeout(() => {
                        if (!isFlipped && settings.autoReadQuestion) {
                            SpeechService.speak(cleanQuestion, settings);
                        } else if (isFlipped && settings.autoReadAnswer) {
                            SpeechService.speak(currentCard.answer, settings);
                        }
                    }, 300);
                }
            }, [currentIndex, isFlipped, settings, isSliding, animationPhase, cleanQuestion]);
            
            // Enhanced navigation with staggered slide animation
            const handleNavigateWithAnimation = (newIndex, direction) => {
                if (isSliding || animationPhase !== 'idle') return; // Prevent multiple animations
                
                setIsSliding(true);
                setSlideDirection(direction);
                setAnimationPhase('slide-out');
                
                // Phase 1: Slide out current card (250ms)
                setTimeout(() => {
                    onNavigate(newIndex);
                    setAnimationPhase('slide-in');
                    
                    // Phase 2: Slide in new card (250ms)
                    setTimeout(() => {
                        setSlideDirection('');
                        setIsSliding(false);
                        setAnimationPhase('idle');
                    }, 250);
                }, 250);
            };
            
            const handleCardClick = () => {
                if (isSliding || animationPhase !== 'idle' || isTransitioning) return; // Prevent clicks during animations
                
                SpeechService.stop();
                setIsTransitioning(true);
                
                // Fade transition: fade out, flip state, then fade in
                setTimeout(() => {
                    onFlip();
                    setTimeout(() => {
                        setIsTransitioning(false);
                    }, 200); // Fade in duration
                }, 200); // Fade out duration
            };
            
            // Enhanced slide animation calculations
            const getSlideTransform = () => {
                if (animationPhase === 'slide-out') {
                    return slideDirection === 'left' 
                        ? 'translateX(-120%) translateZ(-200px) rotateY(-15deg) scale(0.8)'
                        : 'translateX(120%) translateZ(-200px) rotateY(15deg) scale(0.8)';
                } else if (animationPhase === 'slide-in') {
                    return slideDirection === 'left'
                        ? 'translateX(120%) translateZ(-200px) rotateY(15deg) scale(0.8)'
                        : 'translateX(-120%) translateZ(-200px) rotateY(-15deg) scale(0.8)';
                }
                return 'translateX(0) translateZ(0) rotateY(0deg) scale(1)';
            };
            
            const getSlideOpacity = () => {
                if (animationPhase === 'slide-out') return 0;
                if (animationPhase === 'slide-in') return 0.7;
                return 1;
            };
            
            // Touch handlers for gestures with peek animation
            const handleTouchStart = (e) => {
                const touch = e.touches[0];
                touchStartRef.current = { x: touch.clientX, y: touch.clientY };
                setShowHints(false);
                setIsDragging(true);
                
                // Add subtle touch feedback
                e.currentTarget.style.transform = 'scale(0.99)';
                e.currentTarget.style.transition = 'transform 0.1s ease-out';
            };
            
            const handleTouchMove = (e) => {
                if (!isDragging || isSliding || animationPhase !== 'idle' || isTransitioning) return;
                
                const touch = e.touches[0];
                const deltaX = touch.clientX - touchStartRef.current.x;
                
                // Update drag offset for peek effect
                setDragOffset(deltaX);
            };
            
            const handleTouchEnd = (e) => {
                // Remove touch feedback
                e.currentTarget.style.transform = 'scale(1)';
                e.currentTarget.style.transition = 'transform 0.2s ease-out';
                
                setIsDragging(false);
                
                if (isSliding || animationPhase !== 'idle' || isTransitioning) return;
                
                const touch = e.changedTouches[0];
                touchEndRef.current = { x: touch.clientX, y: touch.clientY };
                
                const deltaX = touchEndRef.current.x - touchStartRef.current.x;
                const deltaY = touchEndRef.current.y - touchStartRef.current.y;
                
                const minSwipeDistance = 50;
                
                // Reset drag offset
                setDragOffset(0);
                
                // Determine gesture type
                if (Math.abs(deltaY) > Math.abs(deltaX) && Math.abs(deltaY) > minSwipeDistance) {
                    // Vertical swipe
                    if (deltaY > 0) {
                        // Swipe down - exit fullscreen with fade effect
                        SpeechService.stop();
                        e.currentTarget.style.opacity = '0';
                        e.currentTarget.style.transform = 'scale(0.9) translateY(20px)';
                        e.currentTarget.style.transition = 'all 0.3s ease-out';
                        setTimeout(() => onExit(), 200);
                    }
                } else if (Math.abs(deltaX) > NAVIGATE_THRESHOLD) {
                    // Large horizontal swipe - navigate
                    SpeechService.stop();
                    if (deltaX > 0) {
                        // Swipe right - previous card
                        if (currentIndex > 0) {
                            handleNavigateWithAnimation(currentIndex - 1, 'right');
                        }
                    } else {
                        // Swipe left - next card
                        if (currentIndex < cards.length - 1) {
                            handleNavigateWithAnimation(currentIndex + 1, 'left');
                        }
                    }
                } else if (Math.abs(deltaX) < 30 && Math.abs(deltaY) < 30) {
                    // Small movement - flip card
                    handleCardClick();
                }
                // Medium swipes (between peek and navigate) do nothing - just return to center
            };
            
            return (
                <div className={`fixed inset-0 z-50 ${
                    theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50'
                } flex flex-col`}>
                    {/* Header with counter */}
                    <div className={`flex justify-between items-center p-4 ${
                        theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                    } border-b`}>
                        <div className="text-lg font-semibold">
                            {currentIndex + 1} / {cards.length}
                        </div>
                        <div className="flex items-center gap-4">
                            {/* Subtle points display */}
                            <span className={`text-sm opacity-50 ${
                                theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                            }`}>
                                {currentCard.points || 1}pt
                            </span>
                            <button
                                onClick={onExit}
                                className={`p-2 rounded-lg ${
                                    theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                }`}
                            >
                                ✕
                            </button>
                        </div>
                    </div>
                    
                    {/* Progress bar */}
                    <div className={`h-1 ${theme === 'dark' ? 'bg-gray-800' : 'bg-gray-200'}`}>
                        <div
                            className="h-full bg-blue-500 transition-all duration-300"
                            style={{ width: `${((currentIndex + 1) / cards.length) * 100}%` }}
                        />
                    </div>
                    
                    {/* Main card area with peek animation */}
                    <div 
                        className="flex-1 flex items-center justify-center p-4 perspective-1000 relative overflow-hidden"
                        onTouchStart={handleTouchStart}
                        onTouchMove={handleTouchMove}
                        onTouchEnd={handleTouchEnd}
                    >
                        {/* Previous card preview (right side when dragging right) */}
                        {prevCard && Math.abs(dragOffset) > PEEK_THRESHOLD && dragOffset > 0 && (
                            <div 
                                className="absolute left-0 top-0 w-full h-full flex items-center justify-center p-4"
                                style={{
                                    transform: `translateX(${Math.min(dragOffset - 100, 0)}px) scale(2)`,
                                    opacity: Math.min(Math.abs(dragOffset) / NAVIGATE_THRESHOLD, 0.8),
                                    transformOrigin: 'center center'
                                }}
                            >
                                <div className={`w-full max-w-2xl h-full rounded-3xl p-8 flex flex-col ${
                                    theme === 'dark' 
                                        ? 'bg-gradient-to-br from-gray-700 via-gray-800 to-gray-700 text-white' 
                                        : 'bg-gradient-to-br from-gray-100 via-gray-200 to-gray-100'
                                } shadow-xl overflow-hidden border-2 ${
                                    theme === 'dark' ? 'border-gray-500' : 'border-gray-300'
                                }`}>
                                    <div className="text-center mb-4">
                                        <div className="text-2xl font-light tracking-widest opacity-60">
                                            QUESTION {currentIndex}
                                        </div>
                                    </div>
                                    {/* No text content during peek */}
                                </div>
                            </div>
                        )}
                        
                        {/* Next card preview (left side when dragging left) */}
                        {nextCard && Math.abs(dragOffset) > PEEK_THRESHOLD && dragOffset < 0 && (
                            <div 
                                className="absolute right-0 top-0 w-full h-full flex items-center justify-center p-4"
                                style={{
                                    transform: `translateX(${Math.max(dragOffset + 100, 0)}px) scale(2)`,
                                    opacity: Math.min(Math.abs(dragOffset) / NAVIGATE_THRESHOLD, 0.8),
                                    transformOrigin: 'center center'
                                }}
                            >
                                <div className={`w-full max-w-2xl h-full rounded-3xl p-8 flex flex-col ${
                                    theme === 'dark' 
                                        ? 'bg-gradient-to-br from-gray-700 via-gray-800 to-gray-700 text-white' 
                                        : 'bg-gradient-to-br from-gray-100 via-gray-200 to-gray-100'
                                } shadow-xl overflow-hidden border-2 ${
                                    theme === 'dark' ? 'border-gray-500' : 'border-gray-300'
                                }`}>
                                    <div className="text-center mb-4">
                                        <div className="text-2xl font-light tracking-widest opacity-60">
                                            QUESTION {currentIndex + 2}
                                        </div>
                                    </div>
                                    {/* No text content during peek */}
                                </div>
                            </div>
                        )}
                        
                        {/* Big question numbers when dragging */}
                        {Math.abs(dragOffset) > PEEK_THRESHOLD && (
                            <>
                                {/* Previous question number (when dragging right) */}
                                {dragOffset > 0 && hasPrev && (
                                    <div 
                                        className="absolute left-8 top-1/2 transform -translate-y-1/2 pointer-events-none z-20"
                                        style={{
                                            opacity: Math.min(Math.abs(dragOffset) / NAVIGATE_THRESHOLD, 0.8)
                                        }}
                                    >
                                        <div className={`text-20xl font-bold ${
                                            theme === 'dark' ? 'text-white' : 'text-gray-800'
                                        }`} style={{ fontSize: '10rem', lineHeight: '1' }}>
                                            {currentIndex}
                                        </div>
                                    </div>
                                )}
                                
                                {/* Next question number (when dragging left) */}
                                {dragOffset < 0 && hasNext && (
                                    <div 
                                        className="absolute right-8 top-1/2 transform -translate-y-1/2 pointer-events-none z-20"
                                        style={{
                                            opacity: Math.min(Math.abs(dragOffset) / NAVIGATE_THRESHOLD, 0.8)
                                        }}
                                    >
                                        <div className={`text-20xl font-bold ${
                                            theme === 'dark' ? 'text-white' : 'text-gray-800'
                                        }`} style={{ fontSize: '10rem', lineHeight: '1' }}>
                                            {currentIndex + 2}
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                        
                        {/* Main current card */}
                        <div 
                            className={`relative w-full max-w-2xl h-full cursor-pointer transition-all duration-300 ease-out z-10`}
                            style={{
                                transform: `${getSlideTransform()} translateX(${Math.max(-50, Math.min(50, dragOffset * 0.3))}px)`,
                                transition: isDragging ? 'none' : 'all 0.5s cubic-bezier(0.4, 0.0, 0.2, 1)',
                                filter: animationPhase !== 'idle' ? 'blur(1px)' : 'blur(0px)',
                                opacity: getSlideOpacity()
                            }}
                            onClick={handleCardClick}
                        >
                            {/* Single card container with fade transition */}
                            <div className={`w-full h-full rounded-3xl p-8 flex flex-col ${
                                theme === 'dark' 
                                    ? 'bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800 text-white' 
                                    : 'bg-gradient-to-br from-white via-gray-50 to-white'
                            } shadow-2xl overflow-hidden border-2 ${
                                theme === 'dark' ? 'border-gray-600' : 'border-gray-200'
                            } transition-opacity duration-200`}
                            style={{
                                opacity: isTransitioning ? 0.3 : 1,
                                boxShadow: `
                                    0 25px 50px -12px rgba(0, 0, 0, 0.25),
                                    0 0 30px rgba(59, 130, 246, ${isTransitioning ? '0.3' : '0.1'})
                                `
                            }}>
                                {/* Enhanced label with dynamic numbering */}
                                <div className="text-center mb-4">
                                    <div className={`text-2xl font-light tracking-widest transition-all duration-300 ${
                                        isTransitioning ? 'opacity-20 scale-95' : 'opacity-40'
                                    }`}>
                                        {isFlipped ? `ANSWER ${currentIndex + 1}` : `QUESTION ${currentIndex + 1}`}
                                    </div>
                                </div>
                                
                                {/* Content */}
                                <div className="flex-1 overflow-y-auto flex items-center justify-center">
                                    <div className="text-center w-full">
                                        <h2 className={`text-xl md:text-2xl font-medium leading-relaxed whitespace-pre-line transition-all duration-300 ${
                                            isTransitioning ? 'opacity-30 scale-98' : 'opacity-100 scale-100'
                                        }`}>
                                            {isFlipped ? currentCard.answer : cleanQuestion}
                                        </h2>
                                    </div>
                                </div>
                                
                                {/* Page numbers without triangular corners */}
                                {hasPrev && (
                                    <div className="absolute bottom-4 left-4">
                                        <div className="text-xs font-bold text-gray-600 dark:text-gray-300">
                                            {currentIndex}
                                        </div>
                                    </div>
                                )}
                                
                                {hasNext && (
                                    <div className="absolute bottom-4 right-4">
                                        <div className="text-xs font-bold text-gray-600 dark:text-gray-300">
                                            {currentIndex + 2}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    {/* Enhanced gesture hints with animation */}
                    {showHints && (
                        <div className={`absolute bottom-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-2xl ${
                            theme === 'dark' ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-600'
                        } shadow-xl text-sm text-center backdrop-blur-md bg-opacity-90 border border-opacity-20 ${
                            theme === 'dark' ? 'border-gray-600' : 'border-gray-300'
                        } animate-pulse`}
                        style={{
                            animation: 'fadeInUp 0.5s ease-out, pulse 2s infinite',
                            boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.2), 0 0 20px rgba(59, 130, 246, 0.1)'
                        }}>
                            <div className="flex items-center justify-center gap-1 text-xs">
                                <span className="animate-bounce">👆</span> Tap to flip • 
                                <span className="animate-bounce" style={{animationDelay: '0.1s'}}>←</span> 
                                <span className="animate-bounce" style={{animationDelay: '0.2s'}}>→</span> Drag to peek • 
                                <span className="animate-bounce" style={{animationDelay: '0.3s'}}>↓</span> Swipe down to exit
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Continuous Auto-Play Study Mode
        function ContinuousStudyMode({ cards, onComplete, onExit }) {
            const { state: { theme, settings } } = useFlashCards();
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isPaused, setIsPaused] = useState(false);
            const [phase, setPhase] = useState('ready'); // 'ready', 'intro', 'question', 'answer', 'transition'
            const [startTime] = useState(Date.now());
            
            const currentCard = cards[currentIndex];
            const progress = ((currentIndex + 1) / cards.length) * 100;
            
            // Settings for timing (in milliseconds)
            const PAUSE_AFTER_POINTS = 1200;     // 1.2 seconds after "Question X, Y points"
            const PAUSE_AFTER_QUESTION = 2500;   // 2.5 seconds after question
            const PAUSE_AFTER_ANSWER = 3000;     // 3 seconds after answer
            const PAUSE_BETWEEN_CARDS = 1500;    // 1.5 seconds between cards
            
            useEffect(() => {
                return () => {
                    ContinuousStudyService.stop();
                };
            }, []);
            
            const handlePhaseChange = (newPhase) => {
                setPhase(newPhase);
            };
            
            const handleComplete = () => {
                setIsPlaying(false);
                setIsPaused(false);
                setPhase('complete');
                
                // Calculate session stats
                const duration = Math.floor((Date.now() - startTime) / 1000);
                const totalPoints = cards.reduce((sum, card) => sum + (card.points || 1), 0);
                
                setTimeout(() => {
                    onComplete({ 
                        correct: cards.length,
                        incorrect: 0, 
                        duration,
                        totalPoints,
                        mode: 'continuous'
                    });
                }, 2000); // Give time to hear "complete" message
            };
            
            const startContinuousStudy = () => {
                setIsPlaying(true);
                setIsPaused(false);
                setCurrentIndex(0);
                setPhase('intro');
                
                ContinuousStudyService.start(handlePhaseChange, handleComplete, settings);
                playContinuousSequence(0);
            };
            
            const playContinuousSequence = (startIndex) => {
                let cardIndex = startIndex;
                
                const playNextCard = () => {
                    if (cardIndex >= cards.length) {
                        // All cards completed
                        ContinuousStudyService.addToQueue("Study session complete! Well done!", 0, 'complete');
                        return;
                    }
                    
                    const card = cards[cardIndex];
                    const cleanQuestion = card.question.replace(/^Q\d+\)\s*/, '');
                    
                    // Update current index
                    setCurrentIndex(cardIndex);
                    
                    // Phase 1: Announce question number and points
                    ContinuousStudyService.addToQueue(
                        `Question ${cardIndex + 1}, ${card.points || 1} point${(card.points || 1) > 1 ? 's' : ''}`,
                        PAUSE_AFTER_POINTS,
                        'intro'
                    );
                    
                    // Phase 2: Read the question
                    ContinuousStudyService.addToQueue(
                        cleanQuestion,
                        PAUSE_AFTER_QUESTION,
                        'question'
                    );
                    
                    // Phase 3: Read the answer
                    ContinuousStudyService.addToQueue(
                        card.answer,
                        PAUSE_AFTER_ANSWER,
                        'answer'
                    );
                    
                    // Phase 4: Transition pause and move to next
                    if (cardIndex < cards.length - 1) {
                        ContinuousStudyService.addToQueue(
                            "", // Silent pause
                            PAUSE_BETWEEN_CARDS,
                            'transition'
                        );
                    }
                    
                    cardIndex++;
                    if (cardIndex < cards.length) {
                        // Schedule next card
                        setTimeout(() => playNextCard(), 100);
                    }
                };
                
                playNextCard();
            };
            
            const pauseStudy = () => {
                setIsPaused(true);
                ContinuousStudyService.pause();
            };
            
            const resumeStudy = () => {
                setIsPaused(false);
                ContinuousStudyService.resume();
            };
            
            const stopStudy = () => {
                ContinuousStudyService.stop();
                setIsPlaying(false);
                setIsPaused(false);
                setPhase('ready');
                setCurrentIndex(0);
            };
            
            const getPhaseIcon = () => {
                switch (phase) {
                    case 'intro': return '📢';
                    case 'question': return '❓';
                    case 'answer': return '💡';
                    case 'transition': return '⏭️';
                    case 'complete': return '🎉';
                    default: return '🎵';
                }
            };
            
            const getPhaseText = () => {
                switch (phase) {
                    case 'intro': return `Question ${currentIndex + 1} • ${currentCard?.points || 1}pt`;
                    case 'question': return 'Reading Question';
                    case 'answer': return 'Reading Answer';
                    case 'transition': return 'Moving to Next...';
                    case 'complete': return 'Session Complete!';
                    default: return 'Ready to Start';
                }
            };
            
            if (!settings.speechEnabled) {
                return (
                    <div className="text-center py-12">
                        <Icon name="volume" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                        <h3 className="text-lg font-semibold mb-2">Speech Required</h3>
                        <p className="text-gray-500 mb-4">
                            Please enable "Read Aloud" in the menu to use Continuous Study Mode.
                        </p>
                        <button
                            onClick={onExit}
                            className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium"
                        >
                            Back to Study Options
                        </button>
                    </div>
                );
            }
            
            return (
                <div className="space-y-6 pb-6">
                    {/* Header */}
                    <div className="text-center">
                        <h2 className="text-2xl font-bold mb-2">🎵 Continuous Study Mode</h2>
                        <p className={`text-sm ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>
                            Sit back and listen as all {cards.length} questions are read automatically
                        </p>
                    </div>
                    
                    {/* Progress */}
                    <div className={`p-4 rounded-xl ${theme === 'dark' ? 'bg-gray-800' : 'bg-white'}`}>
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-sm font-medium">
                                {isPlaying ? `Question ${currentIndex + 1} of ${cards.length}` : 'Ready to Start'}
                            </span>
                            <span className="text-sm text-gray-500">
                                {cards.reduce((sum, card) => sum + (card.points || 1), 0)}pt total
                            </span>
                        </div>
                        <div className={`h-3 rounded-full overflow-hidden ${
                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                        }`}>
                            <div
                                className="h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-500"
                                style={{ width: `${progress}%` }}
                            />
                        </div>
                    </div>
                    
                    {/* Current Phase Display */}
                    <div className={`p-6 rounded-xl text-center ${
                        theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                    } border-2 ${
                        isPlaying ? 'border-blue-500' : theme === 'dark' ? 'border-gray-700' : 'border-gray-200'
                    }`}>
                        <div className="text-4xl mb-3 animate-pulse">
                            {getPhaseIcon()}
                        </div>
                        <h3 className="text-lg font-semibold mb-2">
                            {getPhaseText()}
                        </h3>
                        
                        {currentCard && isPlaying && (
                            <div className={`text-sm mt-4 p-3 rounded-lg ${
                                theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'
                            }`}>
                                {phase === 'question' && (
                                    <p className="text-left">{currentCard.question.replace(/^Q\d+\)\s*/, '')}</p>
                                )}
                                {phase === 'answer' && (
                                    <p className="text-left whitespace-pre-line">{currentCard.answer}</p>
                                )}
                                {phase === 'intro' && (
                                    <p className="font-medium">
                                        Question {currentIndex + 1} • {currentCard.points || 1} point{(currentCard.points || 1) > 1 ? 's' : ''}
                                    </p>
                                )}
                            </div>
                        )}
                    </div>
                    
                    {/* Controls */}
                    <div className="space-y-3">
                        {!isPlaying ? (
                            <button
                                onClick={startContinuousStudy}
                                className="w-full py-4 bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-xl hover:from-blue-600 hover:to-purple-600 font-medium text-lg flex items-center justify-center gap-2"
                            >
                                <Icon name="study" className="w-5 h-5" />
                                Start Auto-Play Study
                            </button>
                        ) : (
                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    onClick={isPaused ? resumeStudy : pauseStudy}
                                    className={`py-3 rounded-xl border font-medium transition-all ${
                                        theme === 'dark'
                                            ? 'border-gray-700 hover:bg-gray-800'
                                            : 'border-gray-300 hover:bg-gray-100'
                                    }`}
                                >
                                    {isPaused ? '▶️ Resume' : '⏸️ Pause'}
                                </button>
                                <button
                                    onClick={stopStudy}
                                    className="py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 font-medium transition-all"
                                >
                                    ⏹️ Stop
                                </button>
                            </div>
                        )}
                        
                        <button
                            onClick={onExit}
                            className={`w-full py-3 rounded-xl border font-medium transition-all ${
                                theme === 'dark'
                                    ? 'border-gray-700 hover:bg-gray-800'
                                    : 'border-gray-300 hover:bg-gray-100'
                            }`}
                        >
                            ← Back to Study Options
                        </button>
                    </div>
                    
                    {/* Instructions */}
                    {!isPlaying && (
                        <div className={`p-4 rounded-xl ${
                            theme === 'dark' ? 'bg-gray-800' : 'bg-gray-100'
                        }`}>
                            <h4 className="font-semibold mb-2">How it works:</h4>
                            <ul className="text-sm space-y-1 text-gray-600 dark:text-gray-400">
                                <li>• Questions are announced with point values</li>
                                <li>• Each question is read aloud with pauses</li>
                                <li>• Answers follow automatically</li>
                                <li>• Perfect for hands-free studying</li>
                            </ul>
                        </div>
                    )}
                </div>
            );
        }
        function MobileStudyMode({ cards, onComplete }) {
            const { state: { theme } } = useFlashCards();
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [isFullscreen, setIsFullscreen] = useState(false);
            const [startTime] = useState(Date.now());
            const [showCompletePrompt, setShowCompletePrompt] = useState(false);
            
            const currentCard = cards[currentIndex];
            const progress = ((currentIndex + 1) / cards.length) * 100;
            
            // Calculate total points
            const totalPoints = useMemo(() => {
                return cards.reduce((sum, card) => sum + (card.points || 1), 0);
            }, [cards]);
            
            // Stop speech when component unmounts or session ends
            useEffect(() => {
                return () => {
                    SpeechService.stop();
                };
            }, []);
            
            useEffect(() => {
                if (showCompletePrompt) {
                    SpeechService.stop();
                }
            }, [showCompletePrompt]);
            
            useEffect(() => {
                SpeechService.stop();
            }, [currentIndex]);
            
            const handleFlip = () => {
                setIsFlipped(!isFlipped);
            };
            
            const handleNavigate = (newIndex) => {
                if (newIndex >= 0 && newIndex < cards.length) {
                    setCurrentIndex(newIndex);
                    setIsFlipped(false);
                }
            };
            
            const handleNext = () => {
                if (currentIndex < cards.length - 1) {
                    handleNavigate(currentIndex + 1);
                } else {
                    setShowCompletePrompt(true);
                }
            };
            
            const handleComplete = () => {
                const duration = Math.floor((Date.now() - startTime) / 1000);
                SpeechService.stop();
                onComplete({ 
                    correct: cards.length,
                    incorrect: 0, 
                    duration 
                });
            };
            
            const handleFullscreen = () => {
                setIsFullscreen(true);
            };
            
            const handleExitFullscreen = () => {
                setIsFullscreen(false);
            };
            
            if (!currentCard) {
                return (
                    <div className="flex items-center justify-center h-96">
                        <div className="text-center">
                            <Icon name="study" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                            <p className="text-lg">No cards to study</p>
                        </div>
                    </div>
                );
            }
            
            // **FULLSCREEN MODE**
            if (isFullscreen) {
                return (
                    <FullscreenStudyMode
                        cards={cards}
                        currentIndex={currentIndex}
                        isFlipped={isFlipped}
                        onFlip={handleFlip}
                        onNavigate={handleNavigate}
                        onExit={handleExitFullscreen}
                    />
                );
            }
            
            return (
                <div className="space-y-4 pb-6">
                    <div className="p-4 rounded-xl">
                        <div className="flex justify-between items-center mb-2">
                            <span className="text-sm font-medium">
                                Question {currentIndex + 1} of {cards.length}
                            </span>
                            <div className="flex items-center gap-4">
                                <div className="flex items-center gap-1">
                                    <Icon name="points" className="w-4 h-4 text-blue-500" />
                                    <span className="text-sm font-medium">{totalPoints}pt total</span>
                                </div>
                                {/* **FULLSCREEN BUTTON** */}
                                <button
                                    onClick={handleFullscreen}
                                    className={`px-3 py-1 rounded-lg text-sm font-medium ${
                                        theme === 'dark' 
                                            ? 'bg-gray-700 hover:bg-gray-600 text-gray-300' 
                                            : 'bg-gray-200 hover:bg-gray-300 text-gray-700'
                                    } transition-colors`}
                                >
                                    🔳 Fullscreen
                                </button>
                            </div>
                        </div>
                        <div className={`h-2 rounded-full overflow-hidden ${
                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                        }`}>
                            <div
                                className="h-full bg-blue-500 transition-all duration-500"
                                style={{ width: `${progress}%` }}
                            />
                        </div>
                    </div>
                    
                    <div className="px-4">
                        <MobileStudyCard
                            card={currentCard}
                            isFlipped={isFlipped}
                            onFlip={handleFlip}
                            isFullscreen={false}
                            onToggleFullscreen={handleFullscreen}
                        />
                    </div>
                    
                    <div className="px-4">
                        <div className="grid grid-cols-2 gap-3">
                            <button
                                onClick={() => handleNavigate(currentIndex - 1)}
                                disabled={currentIndex === 0}
                                className={`py-3 rounded-xl border font-medium transition-all ${
                                    currentIndex === 0
                                        ? 'opacity-50 cursor-not-allowed'
                                        : theme === 'dark'
                                        ? 'border-gray-700 hover:bg-gray-800'
                                        : 'border-gray-300 hover:bg-gray-100'
                                }`}
                            >
                                ← Previous
                            </button>
                            <button
                                onClick={handleNext}
                                className="py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium transition-all"
                            >
                                {currentIndex === cards.length - 1 ? 'Complete' : 'Next →'}
                            </button>
                        </div>
                    </div>
                    
                    {showCompletePrompt && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className={`w-full max-w-sm rounded-2xl p-6 ${
                                theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                            }`}>
                                <h3 className="text-xl font-semibold mb-4 text-center">Session Complete! 🎉</h3>
                                <div className="space-y-3 mb-6">
                                    <div className="flex justify-between">
                                        <span>Cards reviewed:</span>
                                        <span className="font-medium">{cards.length}</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Total points:</span>
                                        <span className="font-medium">{totalPoints}pt</span>
                                    </div>
                                    <div className="flex justify-between">
                                        <span>Time spent:</span>
                                        <span className="font-medium">
                                            {Math.floor((Date.now() - startTime) / 60000)}m {Math.floor(((Date.now() - startTime) % 60000) / 1000)}s
                                        </span>
                                    </div>
                                </div>
                                <button
                                    onClick={handleComplete}
                                    className="w-full py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium"
                                >
                                    Finish Session
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Points Selection Modal for Continuous Study
        function ContinuousPointsSelectionModal({ onSelect, onCancel, availablePoints, theme }) {
            const { state: { cards } } = useFlashCards();
            const [selectedPoints, setSelectedPoints] = useState([]);
            
            const togglePoint = (point) => {
                setSelectedPoints(prev => 
                    prev.includes(point) 
                        ? prev.filter(p => p !== point)
                        : [...prev, point]
                );
            };
            
            const selectAll = () => {
                setSelectedPoints(availablePoints);
            };
            
            const clearAll = () => {
                setSelectedPoints([]);
            };
            
            const getCardCountForPoints = (points) => {
                return cards.filter(card => (card.points || 1) === points).length;
            };
            
            const getSelectedCardCount = () => {
                return cards.filter(card => selectedPoints.includes(card.points || 1)).length;
            };
            
            const getTotalPoints = () => {
                return cards
                    .filter(card => selectedPoints.includes(card.points || 1))
                    .reduce((sum, card) => sum + (card.points || 1), 0);
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className={`w-full max-w-sm rounded-2xl p-6 ${
                        theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                    }`}>
                        <h3 className="text-xl font-semibold mb-2">🎵 Continuous Study by Points</h3>
                        <p className={`text-sm mb-4 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>
                            Select which point values for auto-play. Focus on specific difficulty levels while listening hands-free!
                        </p>
                        
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            {availablePoints.map(point => {
                                const count = getCardCountForPoints(point);
                                return (
                                    <button
                                        key={point}
                                        onClick={() => togglePoint(point)}
                                        className={`relative py-3 rounded-xl border transition-all ${
                                            selectedPoints.includes(point)
                                                ? getPointsColor(point) + ' border-transparent'
                                                : theme === 'dark'
                                                ? 'border-gray-700 hover:border-gray-600'
                                                : 'border-gray-300 hover:border-gray-400'
                                        }`}
                                    >
                                        <div className="flex flex-col items-center">
                                            <div className="flex items-center gap-1">
                                                <Icon name="points" className="w-4 h-4" />
                                                <span className="font-medium">{point}pt</span>
                                            </div>
                                            <span className="text-xs opacity-75 mt-1">{count} cards</span>
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                        
                        {selectedPoints.length > 0 && (
                            <div className={`text-center mb-4 p-3 rounded-lg ${
                                theme === 'dark' ? 'bg-gray-800' : 'bg-gray-100'
                            }`}>
                                <div className="text-sm font-medium mb-1">
                                    Selected: {getSelectedCardCount()} cards
                                </div>
                                <div className="text-xs opacity-75">
                                    Total: {getTotalPoints()} points
                                </div>
                            </div>
                        )}
                        
                        <div className="flex gap-2 mb-4">
                            <button
                                onClick={selectAll}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm ${
                                    theme === 'dark' ? 'bg-gray-800 hover:bg-gray-700' : 'bg-gray-100 hover:bg-gray-200'
                                }`}
                            >
                                Select All
                            </button>
                            <button
                                onClick={clearAll}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm ${
                                    theme === 'dark' ? 'bg-gray-800 hover:bg-gray-700' : 'bg-gray-100 hover:bg-gray-200'
                                }`}
                            >
                                Clear All
                            </button>
                        </div>
                        
                        <div className="flex gap-3">
                            <button
                                onClick={onCancel}
                                className={`flex-1 py-3 rounded-xl border ${
                                    theme === 'dark' 
                                        ? 'border-gray-700 hover:bg-gray-800' 
                                        : 'border-gray-300 hover:bg-gray-100'
                                } transition-colors font-medium`}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={() => onSelect(selectedPoints)}
                                disabled={selectedPoints.length === 0}
                                className="flex-1 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                            >
                                Start Auto-Play
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        function PointsSelectionModal({ onSelect, onCancel, availablePoints, theme }) {
            const { state: { cards } } = useFlashCards();
            const [selectedPoints, setSelectedPoints] = useState([]);
            
            const togglePoint = (point) => {
                setSelectedPoints(prev => 
                    prev.includes(point) 
                        ? prev.filter(p => p !== point)
                        : [...prev, point]
                );
            };
            
            const selectAll = () => {
                setSelectedPoints(availablePoints);
            };
            
            const clearAll = () => {
                setSelectedPoints([]);
            };
            
            const getCardCountForPoints = (points) => {
                return cards.filter(card => (card.points || 1) === points).length;
            };
            
            const getSelectedCardCount = () => {
                return cards.filter(card => selectedPoints.includes(card.points || 1)).length;
            };
            
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div className={`w-full max-w-sm rounded-2xl p-6 ${
                        theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                    }`}>
                        <h3 className="text-xl font-semibold mb-2">Study by Points 🏆</h3>
                        <p className={`text-sm mb-4 ${theme === 'dark' ? 'text-gray-400' : 'text-gray-600'}`}>
                            Select which point values to practice. For example, choose only 5pt questions for a challenging session!
                        </p>
                        
                        <div className="grid grid-cols-3 gap-3 mb-4">
                            {availablePoints.map(point => {
                                const count = getCardCountForPoints(point);
                                return (
                                    <button
                                        key={point}
                                        onClick={() => togglePoint(point)}
                                        className={`relative py-3 rounded-xl border transition-all ${
                                            selectedPoints.includes(point)
                                                ? getPointsColor(point) + ' border-transparent'
                                                : theme === 'dark'
                                                ? 'border-gray-700 hover:border-gray-600'
                                                : 'border-gray-300 hover:border-gray-400'
                                        }`}
                                    >
                                        <div className="flex flex-col items-center">
                                            <div className="flex items-center gap-1">
                                                <Icon name="points" className="w-4 h-4" />
                                                <span className="font-medium">{point}pt</span>
                                            </div>
                                            <span className="text-xs opacity-75 mt-1">{count} cards</span>
                                        </div>
                                    </button>
                                );
                            })}
                        </div>
                        
                        {selectedPoints.length > 0 && (
                            <div className={`text-center mb-4 p-2 rounded-lg ${
                                theme === 'dark' ? 'bg-gray-800' : 'bg-gray-100'
                            }`}>
                                <span className="text-sm">
                                    Selected: {getSelectedCardCount()} cards
                                </span>
                            </div>
                        )}
                        
                        <div className="flex gap-2 mb-4">
                            <button
                                onClick={selectAll}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm ${
                                    theme === 'dark' ? 'bg-gray-800 hover:bg-gray-700' : 'bg-gray-100 hover:bg-gray-200'
                                }`}
                            >
                                Select All
                            </button>
                            <button
                                onClick={clearAll}
                                className={`flex-1 py-2 px-3 rounded-lg text-sm ${
                                    theme === 'dark' ? 'bg-gray-800 hover:bg-gray-700' : 'bg-gray-100 hover:bg-gray-200'
                                }`}
                            >
                                Clear All
                            </button>
                        </div>
                        
                        <div className="flex gap-3">
                            <button
                                onClick={onCancel}
                                className={`flex-1 py-3 rounded-xl border ${
                                    theme === 'dark' 
                                        ? 'border-gray-700 hover:bg-gray-800' 
                                        : 'border-gray-300 hover:bg-gray-100'
                                } transition-colors font-medium`}
                            >
                                Cancel
                            </button>
                            <button
                                onClick={() => onSelect(selectedPoints)}
                                disabled={selectedPoints.length === 0}
                                className="flex-1 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                            >
                                Start Study
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Card Editor
        function MobileCardEditor({ card, onSave, onCancel }) {
            const { state: { theme } } = useFlashCards();
            const [question, setQuestion] = useState(card?.question || '');
            const [answer, setAnswer] = useState(card?.answer || '');
            const [category, setCategory] = useState(card?.category || '');
            const [points, setPoints] = useState(card?.points || 1);
            
            const handleSubmit = () => {
                if (!question.trim() || !answer.trim()) return;
                
                onSave({
                    question: question.trim(),
                    answer: answer.trim(),
                    category: category.trim(),
                    tags: [],
                    points: points,
                    media: [],
                });
            };
            
            return (
                <div className="space-y-6">
                    <div>
                        <label className="block text-sm font-medium mb-2">Question</label>
                        <textarea
                            value={question}
                            onChange={(e) => setQuestion(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            rows={3}
                            placeholder="Enter your question..."
                            required
                        />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-2">Answer</label>
                        <textarea
                            value={answer}
                            onChange={(e) => setAnswer(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            rows={3}
                            placeholder="Enter the answer..."
                            required
                        />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-2">Category</label>
                        <input
                            value={category}
                            onChange={(e) => setCategory(e.target.value)}
                            className={`w-full px-4 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'bg-gray-800 border-gray-700 text-white' 
                                    : 'bg-white border-gray-300'
                            } focus:outline-none focus:ring-2 focus:ring-blue-500 text-base`}
                            placeholder="Optional category"
                        />
                    </div>
                    
                    <div>
                        <label className="block text-sm font-medium mb-3">Points</label>
                        <div className="grid grid-cols-6 gap-2">
                            {[1, 2, 3, 4, 5, 6].map(pt => (
                                <button
                                    key={pt}
                                    type="button"
                                    onClick={() => setPoints(pt)}
                                    className={`py-3 rounded-xl border transition-colors text-sm font-medium ${
                                        points === pt
                                            ? getPointsColor(pt) + ' border-transparent'
                                            : theme === 'dark'
                                            ? 'border-gray-700 hover:border-gray-600'
                                            : 'border-gray-300 hover:border-gray-400'
                                    }`}
                                >
                                    {pt}pt
                                </button>
                            ))}
                        </div>
                    </div>
                    
                    <div className="flex gap-3 pt-4">
                        <button
                            type="button"
                            onClick={onCancel}
                            className={`flex-1 py-3 rounded-xl border ${
                                theme === 'dark' 
                                    ? 'border-gray-700 hover:bg-gray-800' 
                                    : 'border-gray-300 hover:bg-gray-100'
                            } transition-colors font-medium`}
                        >
                            Cancel
                        </button>
                        <button
                            type="button"
                            onClick={handleSubmit}
                            disabled={!question.trim() || !answer.trim()}
                            className="flex-1 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium"
                        >
                            {card ? 'Update' : 'Create'}
                        </button>
                    </div>
                </div>
            );
        }

        // Provider Component
        function FlashCardsProvider({ children }) {
            const [state, setState] = useState(() => {
                const saved = StorageService.load();
                // If saved data exists but cards don't have points, migrate them
                if (saved?.cards) {
                    saved.cards = saved.cards.map(card => {
                        if (!card.points) {
                            // Convert difficulty to points
                            const pointsMap = { easy: 1, medium: 3, hard: 5 };
                            return { ...card, points: pointsMap[card.difficulty] || 1 };
                        }
                        return card;
                    });
                }
                return {
                    cards: saved?.cards || createDefaultCards(),
                    categories: saved?.categories || new Set(['Theory Questions']),
                    studySessions: saved?.studySessions || [],
                    cardProgress: saved?.cardProgress || {},
                    theme: saved?.theme || 'dark',
                    settings: saved?.settings || {
                        dailyGoal: 20,
                        notificationsEnabled: false,
                        soundEnabled: true,
                        autoAdvance: true,
                        studyReminders: [],
                        speechEnabled: true,
                        speechRate: 1.0,
                        speechVoice: '',
                        autoReadQuestion: true,
                        autoReadAnswer: true,
                    },
                };
            });
            
            useEffect(() => {
                StorageService.save(state);
            }, [state]);
            
            useEffect(() => {
                document.documentElement.classList.toggle('dark', state.theme === 'dark');
            }, [state.theme]);
            
            const addCard = (card) => {
                const newCard = {
                    ...card,
                    id: Date.now().toString(),
                    created: new Date().toISOString(),
                    lastStudied: null,
                    nextReview: null,
                    timesStudied: 0,
                    timesCorrect: 0,
                    easeFactor: 2.5,
                    interval: 0,
                    repetitions: 0,
                    lapses: 0,
                };
                
                setState(prev => ({
                    ...prev,
                    cards: [...prev.cards, newCard],
                    categories: new Set([...prev.categories, card.category].filter(Boolean)),
                }));
            };
            
            const updateCard = (id, updates) => {
                setState(prev => ({
                    ...prev,
                    cards: prev.cards.map(card => 
                        card.id === id ? { ...card, ...updates } : card
                    ),
                    categories: updates.category 
                        ? new Set([...prev.categories, updates.category])
                        : prev.categories,
                }));
            };
            
            const deleteCard = (id) => {
                setState(prev => ({
                    ...prev,
                    cards: prev.cards.filter(card => card.id !== id),
                }));
            };
            
            const addStudySession = (session) => {
                setState(prev => ({
                    ...prev,
                    studySessions: [
                        ...prev.studySessions,
                        { ...session, id: Date.now().toString() },
                    ],
                }));
            };
            
            const toggleTheme = () => {
                setState(prev => ({
                    ...prev,
                    theme: prev.theme === 'dark' ? 'light' : 'dark',
                }));
            };
            
            const importData = (importedData) => {
                setState(prev => ({
                    ...prev,
                    cards: [...prev.cards, ...importedData.cards],
                    categories: new Set([...prev.categories, ...importedData.categories]),
                }));
            };
            
            const clearAllCards = () => {
                setState(prev => ({
                    ...prev,
                    cards: [],
                    categories: new Set(['Theory Questions']),
                    studySessions: [],
                    cardProgress: {},
                }));
            };
            
            const toggleSpeech = () => {
                setState(prev => ({
                    ...prev,
                    settings: {
                        ...prev.settings,
                        speechEnabled: !prev.settings.speechEnabled,
                        autoReadQuestion: !prev.settings.speechEnabled,
                        autoReadAnswer: !prev.settings.speechEnabled,
                    }
                }));
                
                if (state.settings.speechEnabled) {
                    SpeechService.stop();
                }
            };
            
            const value = {
                state,
                addCard,
                updateCard,
                deleteCard,
                addStudySession,
                toggleTheme,
                importData,
                clearAllCards,
                toggleSpeech,
            };
            
            return React.createElement(FlashCardsContext.Provider, { value }, children);
        }

        // Main App Component
        function MobileFlashCardsApp() {
            const { state, toggleTheme, addCard, updateCard, deleteCard, addStudySession, importData, clearAllCards, toggleSpeech } = useFlashCards();
            const { theme, cards, categories, settings } = state;
            
            const [activeView, setActiveView] = useState('cards');
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('');
            const [selectedPoints, setSelectedPoints] = useState([]);
            const [showCardEditor, setShowCardEditor] = useState(false);
            const [editingCard, setEditingCard] = useState(undefined);
            const [isStudying, setIsStudying] = useState(false);
            const [showMenu, setShowMenu] = useState(false);
            const [showPointsSelection, setShowPointsSelection] = useState(false);
            const [showContinuousPointsSelection, setShowContinuousPointsSelection] = useState(false);
            const [studyCards, setStudyCards] = useState([]);
            const [studyMode, setStudyMode] = useState('manual'); // 'manual', 'continuous'
            
            const fileInputRef = React.useRef(null);
            
            // Get unique point values
            const availablePoints = useMemo(() => {
                const points = [...new Set(cards.map(card => card.points || 1))].sort((a, b) => a - b);
                return points;
            }, [cards]);
            
            useEffect(() => {
                if (activeView !== 'study' || !isStudying) {
                    SpeechService.stop();
                }
            }, [activeView, isStudying]);
            
            const handleImport = () => {
                fileInputRef.current?.click();
                setShowMenu(false);
            };
            
            const handleClearAll = () => {
                const confirmed = confirm(
                    `Are you sure you want to delete ALL ${cards.length} cards?\n\nThis action cannot be undone and will also clear all your study progress.`
                );
                if (confirmed) {
                    SpeechService.stop();
                    clearAllCards();
                    setShowMenu(false);
                    alert('All cards have been cleared. You now have a clean slate!');
                }
            };
            
            const handleFileChange = (event) => {
                const file = event.target.files?.[0];
                if (!file) return;
                
                StorageService.importData(
                    file,
                    (data) => {
                        importData(data);
                        alert(`Successfully imported ${data.cards.length} cards!`);
                    },
                    (error) => {
                        alert(`Import failed: ${error}`);
                    }
                );
                
                // Reset file input
                event.target.value = '';
            };
            
            const filteredCards = useMemo(() => {
                return cards.filter(card => {
                    const matchesSearch = !searchQuery || 
                        card.question.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        card.answer.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        card.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()));
                    
                    const matchesCategory = !selectedCategory || card.category === selectedCategory;
                    const matchesPoints = selectedPoints.length === 0 || selectedPoints.includes(card.points || 1);
                    
                    return matchesSearch && matchesCategory && matchesPoints;
                });
            }, [cards, searchQuery, selectedCategory, selectedPoints]);
            
            const handleStudyComplete = (results) => {
                addStudySession({
                    date: new Date().toISOString(),
                    duration: results.duration,
                    cardsStudied: results.correct + results.incorrect,
                    correctCount: results.correct,
                    mode: results.mode || 'standard',
                    totalPoints: results.totalPoints || 0,
                });
                
                setIsStudying(false);
                setStudyCards([]);
                setStudyMode('manual');
            };
            
            const startStudyingCard = (card) => {
                SpeechService.stop();
                setStudyCards([card]);
                setStudyMode('manual');
                setIsStudying(true);
                setActiveView('study');
            };
            
            const handlePointsSelectionForStudy = (points) => {
                const cardsToStudy = cards.filter(card => points.includes(card.points || 1));
                setStudyCards(cardsToStudy);
                setShowPointsSelection(false);
                setStudyMode('manual');
                setIsStudying(true);
            };
            
            const handleContinuousPointsSelectionForStudy = (points) => {
                const cardsToStudy = cards.filter(card => points.includes(card.points || 1));
                setStudyCards(cardsToStudy);
                setShowContinuousPointsSelection(false);
                setStudyMode('continuous');
                setIsStudying(true);
            };
            
            const totalPoints = useMemo(() => {
                return cards.reduce((sum, card) => sum + (card.points || 1), 0);
            }, [cards]);
            
            const handleViewChange = (newView) => {
                SpeechService.stop();
                ContinuousStudyService.stop();
                setActiveView(newView);
                setIsStudying(false);
                setStudyMode('manual');
            };
            
            return (
                <div className={`min-h-screen ${theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`}>
                    <header className={`sticky top-0 z-40 ${
                        theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                    } border-b backdrop-blur-md bg-opacity-90`}>
                        <div className="px-4 py-3">
                            <div className="flex justify-between items-center">
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <span className="bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                                        Flash Cards Pro
                                    </span>
                                    <span className={`text-sm px-2 py-0.5 rounded-full ${
                                        theme === 'dark' ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-600'
                                    }`}>
                                        v6.1
                                    </span>
                                </h1>
                                
                                <div className="flex items-center gap-2">
                                    <button
                                        onClick={toggleTheme}
                                        className={`p-2 rounded-lg ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}
                                    >
                                        <Icon name={theme === 'dark' ? 'sun' : 'moon'} />
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowMenu(!showMenu)}
                                        className={`p-2 rounded-lg ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}
                                    >
                                        <Icon name="menu" />
                                    </button>
                                </div>
                            </div>
                            
                            {activeView === 'cards' && !isStudying && (
                                <div className="mt-3 space-y-3">
                                    <div className="relative">
                                        <Icon name="search" className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" />
                                        <input
                                            type="text"
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            placeholder="Search cards..."
                                            className={`w-full pl-10 pr-4 py-2 rounded-xl text-base ${
                                                theme === 'dark'
                                                    ? 'bg-gray-700 border-gray-600'
                                                    : 'bg-gray-100 border-gray-300'
                                            } border focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                        />
                                    </div>
                                    
                                    {/* Points filter */}
                                    {availablePoints.length > 0 && (
                                        <div className="flex gap-2 overflow-x-auto pb-1">
                                            <button
                                                onClick={() => setSelectedPoints([])}
                                                className={`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap ${
                                                    selectedPoints.length === 0
                                                        ? 'bg-blue-500 text-white'
                                                        : theme === 'dark'
                                                        ? 'bg-gray-800 text-gray-300'
                                                        : 'bg-gray-200 text-gray-700'
                                                }`}
                                            >
                                                All Points
                                            </button>
                                            {availablePoints.map(pt => (
                                                <button
                                                    key={pt}
                                                    onClick={() => {
                                                        setSelectedPoints(prev =>
                                                            prev.includes(pt)
                                                                ? prev.filter(p => p !== pt)
                                                                : [...prev, pt]
                                                        );
                                                    }}
                                                    className={`px-3 py-1.5 rounded-lg text-xs font-medium whitespace-nowrap flex items-center gap-1 ${
                                                        selectedPoints.includes(pt)
                                                            ? getPointsColor(pt)
                                                            : theme === 'dark'
                                                            ? 'bg-gray-800 text-gray-300'
                                                            : 'bg-gray-200 text-gray-700'
                                                    }`}
                                                >
                                                    <Icon name="points" className="w-3 h-3" />
                                                    {pt}pt
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </header>
                    
                    {showMenu && (
                        <div className="fixed inset-0 z-50" onClick={() => setShowMenu(false)}>
                            <div className={`absolute top-16 right-4 w-52 rounded-xl shadow-lg ${
                                theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                            } border overflow-hidden`}>
                                <button
                                    onClick={() => {
                                        setShowCardEditor(true);
                                        setShowMenu(false);
                                    }}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}
                                >
                                    <Icon name="plus" className="w-4 h-4" />
                                    New Card
                                </button>
                                <button
                                    onClick={handleImport}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}
                                >
                                    📥 Import Cards
                                </button>
                                <button
                                    onClick={() => {
                                        StorageService.exportData(state);
                                        setShowMenu(false);
                                    }}
                                    className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                        theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                    }`}
                                >
                                    💾 Export Data
                                </button>
                                <div className={`border-t ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                                    <button
                                        onClick={() => {
                                            toggleSpeech();
                                            setShowMenu(false);
                                        }}
                                        className={`w-full px-4 py-3 text-left flex items-center gap-3 ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}
                                    >
                                        {settings.speechEnabled ? '🔊' : '🔇'} Read Aloud {settings.speechEnabled ? 'ON' : 'OFF'}
                                    </button>
                                </div>
                                <div className={`border-t ${theme === 'dark' ? 'border-gray-700' : 'border-gray-200'}`}>
                                    <button
                                        onClick={handleClearAll}
                                        className={`w-full px-4 py-3 text-left flex items-center gap-3 text-red-500 ${
                                            theme === 'dark' ? 'hover:bg-gray-700' : 'hover:bg-gray-100'
                                        }`}
                                    >
                                        🗑️ Clear All Cards
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Hidden file input for import */}
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept=".txt,.json"
                        onChange={handleFileChange}
                        style={{ display: 'none' }}
                    />
                    
                    <main className="px-4 py-4 pb-20">
                        {activeView === 'cards' && !isStudying && (
                            <div className="space-y-4">
                                {categories.size > 0 && (
                                    <div className="flex gap-2 overflow-x-auto pb-2">
                                        <button
                                            onClick={() => setSelectedCategory('')}
                                            className={`px-3 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${
                                                !selectedCategory
                                                    ? 'bg-blue-500 text-white'
                                                    : theme === 'dark'
                                                    ? 'bg-gray-800 text-gray-300'
                                                    : 'bg-gray-200 text-gray-700'
                                            }`}
                                        >
                                            All
                                        </button>
                                        {Array.from(categories).map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setSelectedCategory(cat)}
                                                className={`px-3 py-2 rounded-xl text-sm font-medium whitespace-nowrap ${
                                                    selectedCategory === cat
                                                        ? 'bg-blue-500 text-white'
                                                        : theme === 'dark'
                                                        ? 'bg-gray-800 text-gray-300'
                                                        : 'bg-gray-200 text-gray-700'
                                                }`}
                                            >
                                                {cat}
                                            </button>
                                        ))}
                                    </div>
                                )}
                                
                                {filteredCards.length === 0 ? (
                                    <div className="text-center py-12">
                                        <Icon name="study" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                                        <p className="text-lg mb-2">No cards found</p>
                                        <p className="text-gray-500 mb-4">Create your first card to get started!</p>
                                        <button
                                            onClick={() => setShowCardEditor(true)}
                                            className="px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 font-medium"
                                        >
                                            Create Card
                                        </button>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        {filteredCards.map(card => (
                                            <MobileCardItem
                                                key={card.id}
                                                card={card}
                                                onEdit={() => {
                                                    setEditingCard(card);
                                                    setShowCardEditor(true);
                                                }}
                                                onDelete={() => {
                                                    if (confirm('Delete this card?')) {
                                                        deleteCard(card.id);
                                                    }
                                                }}
                                                onStudy={() => startStudyingCard(card)}
                                            />
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {activeView === 'study' && !isStudying && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-center mb-6">Ready to Study? 📚</h2>
                                
                                <div className={`p-6 rounded-xl ${
                                    theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                } text-center`}>
                                    <Icon name="brain" className="w-12 h-12 mx-auto mb-4 text-blue-500" />
                                    <h3 className="text-lg font-semibold mb-2">Study Session</h3>
                                    <p className={`text-sm mb-4 ${
                                        theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                    }`}>
                                        Choose how you want to study your {cards.length} flashcards
                                    </p>
                                    
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setStudyMode('continuous');
                                                setStudyCards(filteredCards);
                                                setIsStudying(true);
                                            }}
                                            disabled={filteredCards.length === 0}
                                            className="w-full py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl hover:from-purple-600 hover:to-pink-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg font-medium relative overflow-hidden group"
                                        >
                                            <div className="absolute inset-0 bg-white opacity-10 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                                            <div className="relative flex items-center justify-center gap-2">
                                                🎵 Continuous Auto-Play (All)
                                            </div>
                                            <div className="text-xs opacity-75 mt-1">Listen hands-free to all {filteredCards.length} questions automatically</div>
                                        </button>
                                        
                                        <button
                                            onClick={() => setShowContinuousPointsSelection(true)}
                                            disabled={filteredCards.length === 0}
                                            className="w-full py-4 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg font-medium relative overflow-hidden group"
                                        >
                                            <div className="absolute inset-0 bg-white opacity-10 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                                            <div className="relative flex items-center justify-center gap-2">
                                                <Icon name="points" className="w-5 h-5" />
                                                🎵 Continuous by Points
                                            </div>
                                            <div className="text-xs opacity-75 mt-1">Auto-play specific difficulty levels (1pt, 2pt, 3pt, etc.)</div>
                                        </button>
                                        
                                        <button
                                            onClick={() => setShowPointsSelection(true)}
                                            disabled={filteredCards.length === 0}
                                            className="w-full py-4 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg font-medium relative overflow-hidden group"
                                        >
                                            <div className="absolute inset-0 bg-white opacity-10 transform translate-x-full group-hover:translate-x-0 transition-transform duration-300"></div>
                                            <div className="relative flex items-center justify-center gap-2">
                                                <Icon name="points" className="w-5 h-5" />
                                                Study by Points (Manual)
                                            </div>
                                            <div className="text-xs opacity-75 mt-1">Select difficulty levels and flip cards manually</div>
                                        </button>
                                        
                                        <button
                                            onClick={() => {
                                                setStudyMode('manual');
                                                setStudyCards(filteredCards);
                                                setIsStudying(true);
                                            }}
                                            disabled={filteredCards.length === 0}
                                            className="w-full py-4 bg-green-500 text-white rounded-xl hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed text-lg font-medium"
                                        >
                                            Manual Study All ({filteredCards.length} cards)
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Quick Stats */}
                                <div className={`grid grid-cols-3 gap-3 ${
                                    theme === 'dark' ? 'text-gray-300' : 'text-gray-700'
                                }`}>
                                    {[1, 2, 3, 4, 5, 6].map(pt => {
                                        const count = cards.filter(c => (c.points || 1) === pt).length;
                                        if (count === 0) return null;
                                        return (
                                            <div key={pt} className={`p-3 rounded-lg text-center ${
                                                theme === 'dark' ? 'bg-gray-800' : 'bg-gray-100'
                                            }`}>
                                                <div className={`text-xs px-2 py-1 rounded inline-flex items-center gap-1 mb-1 ${getPointsColor(pt)}`}>
                                                    <Icon name="points" className="w-3 h-3" />
                                                    {pt}pt
                                                </div>
                                                <div className="text-sm font-medium">{count} cards</div>
                                            </div>
                                        );
                                    }).filter(Boolean)}
                                </div>
                            </div>
                        )}
                        
                        {(activeView === 'study' || activeView === 'cards') && isStudying && studyMode === 'manual' && (
                            <MobileStudyMode
                                cards={studyCards}
                                onComplete={handleStudyComplete}
                            />
                        )}
                        
                        {(activeView === 'study' || activeView === 'cards') && isStudying && studyMode === 'continuous' && (
                            <ContinuousStudyMode
                                cards={studyCards}
                                onComplete={handleStudyComplete}
                                onExit={() => {
                                    setIsStudying(false);
                                    setStudyCards([]);
                                    setStudyMode('manual');
                                }}
                            />
                        )}
                        
                        {activeView === 'stats' && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-center">Your Progress 📊</h2>
                                
                                <div className="grid grid-cols-2 gap-4">
                                    <div className={`p-4 rounded-xl ${
                                        theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                    } text-center`}>
                                        <div className="text-3xl font-bold text-blue-500">{cards.length}</div>
                                        <div className="text-sm text-gray-500">Total Cards</div>
                                        <div className="text-xs text-gray-400 mt-1">All 78 questions loaded!</div>
                                    </div>
                                    
                                    <div className={`p-4 rounded-xl ${
                                        theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                    } text-center`}>
                                        <div className="text-2xl font-bold text-yellow-500 flex items-center justify-center gap-1">
                                            <Icon name="points" className="w-6 h-6" />
                                            {totalPoints}
                                        </div>
                                        <div className="text-sm text-gray-500">Total Points</div>
                                    </div>
                                    
                                    <div className={`p-4 rounded-xl ${
                                        theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                    } text-center`}>
                                        <div className="text-2xl font-bold text-purple-500">
                                            {Array.from(categories).length}
                                        </div>
                                        <div className="text-sm text-gray-500">Categories</div>
                                    </div>
                                    
                                    <div className={`p-4 rounded-xl ${
                                        theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                    } text-center`}>
                                        <div className="text-2xl font-bold text-green-500">
                                            {state.studySessions.length}
                                        </div>
                                        <div className="text-sm text-gray-500">Study Sessions</div>
                                    </div>
                                </div>
                                
                                {/* Points breakdown */}
                                <div className={`p-4 rounded-xl ${
                                    theme === 'dark' ? 'bg-gray-800' : 'bg-white'
                                }`}>
                                    <h3 className="font-semibold mb-3">Points Distribution</h3>
                                    <p className="text-xs text-gray-500 mb-3">Study specific point values to focus your learning!</p>
                                    <div className="space-y-2">
                                        {availablePoints.map(pt => {
                                            const count = cards.filter(c => (c.points || 1) === pt).length;
                                            const percentage = (count / cards.length) * 100;
                                            return (
                                                <div key={pt} className="flex items-center gap-3">
                                                    <span className={`text-xs px-2 py-1 rounded flex items-center gap-1 ${getPointsColor(pt)}`}>
                                                        <Icon name="points" className="w-3 h-3" />
                                                        {pt}pt
                                                    </span>
                                                    <div className="flex-1">
                                                        <div className={`h-2 rounded-full overflow-hidden ${
                                                            theme === 'dark' ? 'bg-gray-700' : 'bg-gray-200'
                                                        }`}>
                                                            <div
                                                                className="h-full bg-blue-500 transition-all"
                                                                style={{ width: `${percentage}%` }}
                                                            />
                                                        </div>
                                                    </div>
                                                    <span className="text-sm text-gray-500 w-12 text-right">{count}</span>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                    
                    {showCardEditor && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center p-4 z-50 overflow-y-auto">
                            <div className={`w-full max-w-lg my-8 rounded-2xl ${
                                theme === 'dark' ? 'bg-gray-900' : 'bg-white'
                            } p-6`}>
                                <h2 className="text-xl font-semibold mb-6">
                                    {editingCard ? 'Edit Card ✏️' : 'Create New Card ➕'}
                                </h2>
                                <MobileCardEditor
                                    card={editingCard}
                                    onSave={(card) => {
                                        if (editingCard) {
                                            updateCard(editingCard.id, card);
                                        } else {
                                            addCard(card);
                                        }
                                        setShowCardEditor(false);
                                        setEditingCard(undefined);
                                    }}
                                    onCancel={() => {
                                        setShowCardEditor(false);
                                        setEditingCard(undefined);
                                    }}
                                />
                            </div>
                        </div>
                    )}
                    
                    {showPointsSelection && (
                        <PointsSelectionModal
                            onSelect={handlePointsSelectionForStudy}
                            onCancel={() => setShowPointsSelection(false)}
                            availablePoints={availablePoints}
                            theme={theme}
                        />
                    )}
                    
                    {showContinuousPointsSelection && (
                        <ContinuousPointsSelectionModal
                            onSelect={handleContinuousPointsSelectionForStudy}
                            onCancel={() => setShowContinuousPointsSelection(false)}
                            availablePoints={availablePoints}
                            theme={theme}
                        />
                    )}
                    
                    <nav className={`fixed bottom-0 left-0 right-0 z-40 ${
                        theme === 'dark' ? 'bg-gray-800 border-gray-700' : 'bg-white border-gray-200'
                    } border-t`}>
                        <div className="flex justify-around py-2">
                            <button
                                onClick={() => handleViewChange('cards')}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'cards' && !isStudying 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}
                            >
                                <Icon name="cards" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Cards</span>
                            </button>
                            <button
                                onClick={() => handleViewChange('study')}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'study' || isStudying 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}
                            >
                                <Icon name="study" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Study</span>
                            </button>
                            <button
                                onClick={() => handleViewChange('stats')}
                                className={`flex flex-col items-center p-3 rounded-lg transition-colors ${
                                    activeView === 'stats' 
                                        ? 'text-blue-500' 
                                        : theme === 'dark' ? 'text-gray-400' : 'text-gray-600'
                                }`}
                            >
                                <Icon name="stats" className="w-6 h-6 mb-1" />
                                <span className="text-xs">Stats</span>
                            </button>
                        </div>
                    </nav>
                </div>
            );
        }

        // Root App
        function App() {
            return React.createElement(
                FlashCardsProvider,
                null,
                React.createElement(MobileFlashCardsApp)
            );
        }

        // Render the app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
